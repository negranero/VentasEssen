(function(g){var window=this;'use strict';var uwf=function(J){var R=new g.WV("und",new g.EV("Default","und",!0));R.captionTracks=J.captionTracks;return R},fyE=function(J){return new g.KC(function(R,N){var C=J.length,X=[];
if(C)for(var u=function(v,W){C--;X[v]=W;C==0&&R(X)},f=function(v){N(v)},H,k=0;k<J.length;k++)H=J[k],g.Zgg(H,g.hk(u,k),f);
else R(X)})},Cx=function(J){this.K=J},X4=function(){Cx.apply(this,arguments)},TbK=function(){X4.apply(this,arguments)},$WL=function(){X4.apply(this,arguments)},HHJ=function(){X4.apply(this,arguments)},k4d=function(){X4.apply(this,arguments)},vZf=function(){X4.apply(this,arguments)},Wna=function(){Cx.apply(this,arguments)},Sk8=function(){X4.apply(this,arguments)},LnK=function(){X4.apply(this,arguments)},Iya=function(){X4.apply(this,arguments)},Fnl=function(){X4.apply(this,arguments)},EZ9=function(){X4.apply(this,
arguments)},MAf=function(){X4.apply(this,arguments)},Kn8=function(){X4.apply(this,arguments)},ayl=function(){X4.apply(this,arguments)},QME=function(){X4.apply(this,arguments)},nZV=function(){X4.apply(this,arguments)},DWJ=function(){X4.apply(this,arguments)},sMd=function(){X4.apply(this,arguments)},BbV=function(){Cx.apply(this,arguments)},OHa=function(){X4.apply(this,arguments)},ZHJ=function(){X4.apply(this,arguments)},dWf=function(){X4.apply(this,arguments)},qkk=function(){X4.apply(this,arguments)},
Atf=function(){X4.apply(this,arguments)},Ykq=function(){X4.apply(this,arguments)},rtE=function(){X4.apply(this,arguments)},jMV=function(){X4.apply(this,arguments)},mW9=function(){X4.apply(this,arguments)},VAq=function(){Cx.apply(this,arguments)},gZk=function(){Cx.apply(this,arguments)},UWV=function(){Cx.apply(this,arguments)},pwU=function(){X4.apply(this,arguments)},lyd=function(){X4.apply(this,arguments)},Pzq=function(){X4.apply(this,arguments)},zNJ=function(){X4.apply(this,arguments)},eN8=function(){X4.apply(this,
arguments)},wwq=function(){X4.apply(this,arguments)},ctl=function(){X4.apply(this,arguments)},hN8=function(){X4.apply(this,arguments)},ytV=function(){X4.apply(this,arguments)},G4q=function(){X4.apply(this,arguments)},bH_=function(){X4.apply(this,arguments)},tAU=function(){X4.apply(this,arguments)},xWK=function(){X4.apply(this,arguments)},JPf=function(){X4.apply(this,arguments)},ogd=function(){X4.apply(this,arguments)},R59=function(){X4.apply(this,arguments)},N5U=function(){X4.apply(this,arguments)},
C7f=function(){X4.apply(this,arguments)},XpV=function(){X4.apply(this,arguments)},imk=function(){X4.apply(this,arguments)},uuJ=function(){X4.apply(this,arguments)},fhl=function(){X4.apply(this,arguments)},T59=function(){X4.apply(this,arguments)},$uV=function(){X4.apply(this,arguments)},Hmq=function(){X4.apply(this,arguments)},kN9=function(){Cx.apply(this,arguments)},vga=function(){X4.apply(this,arguments)},W8k=function(){X4.apply(this,arguments)},Slf=function(){X4.apply(this,arguments)},L8d=function(){X4.apply(this,
arguments)},Ihq=function(){X4.apply(this,arguments)},F8E=function(){X4.apply(this,arguments)},EgJ=function(){X4.apply(this,arguments)},M4q=function(){X4.apply(this,arguments)},K8a=function(){X4.apply(this,arguments)},ahd=function(){X4.apply(this,arguments)},QgK=function(){X4.apply(this,arguments)},ngV=function(){X4.apply(this,arguments)},DuV=function(){X4.apply(this,arguments)},sga=function(){X4.apply(this,arguments)},B5q=function(){X4.apply(this,arguments)},Omd=function(){X4.apply(this,arguments)},
ZmV=function(){X4.apply(this,arguments)},duP=function(){X4.apply(this,arguments)},qlV=function(){X4.apply(this,arguments)},APd=function(){X4.apply(this,arguments)},Yla=function(){X4.apply(this,arguments)},rPV=function(){X4.apply(this,arguments)},jgV=function(){X4.apply(this,arguments)},muU=function(){X4.apply(this,arguments)},V4K=function(){X4.apply(this,arguments)},ggL=function(){X4.apply(this,arguments)},UuV=function(){X4.apply(this,arguments)},ppq=function(){X4.apply(this,arguments)},lhk=function(J){J=
J.key||J.id;
if(!J)throw Error("Entity key is missing");return J},P7a=function(){if(iQ)return iQ();
var J={};iQ=g.ks("PersistentEntityStoreDb",{Fm:(J.EntityStore={P4:1},J.EntityAssociationStore={P4:2},J),shared:!1,upgrade:function(R,N){N(1)&&g.c9(g.p3(R,"EntityStore",{keyPath:"key"}),"entityType","entityType");N(2)&&(R=g.p3(R,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.c9(R,"byParentEntityKey","parentEntityKey"),g.c9(R,"byChildEntityKey","childEntityKey"))},
version:3});return iQ()},z5d=function(J){return g.oN(P7a(),J)},e5U=function(J){return g.oN((0,g.FgJ)(),J)},uQ=function(J){this.token=J},fx=function(J,R){R=R===void 0?{}:R;
g.C3.call(this,g.E19[J],Object.assign({},{name:"PESEncoderError",type:J},R));this.type=J;this.level="WARNING";Object.setPrototypeOf(this,fx.prototype)},wpL=function(J){return new fx("WRONG_DATA_TYPE",{sE:J})},cPJ=function(J){return J instanceof Error?new fx("UNKNOWN_ENCODE_ERROR",{PW:J.message}):new fx("UNKNOWN_ENCODE_ERROR")},h59=function(J){return J instanceof Error?new fx("UNKNOWN_DECODE_ERROR",{PW:J.message}):new fx("UNKNOWN_DECODE_ERROR")},yP9=function(J,R){J=J instanceof fx?J:R(J);
g.yD(J);throw J;},GNV=function(){},bmV=function(J,R,N){try{return J.V(R,N)}catch(C){yP9(C,cPJ)}},t4f=function(J){J=(new TextEncoder).encode(J).subarray(0,16);
var R=new Uint8Array(16);R.set(J);return R},TU=function(J){this.K=J},JXq=function(J){var R=xuK[J];
if(R)return R;g.G$(new g.C3("Entity model not found.",{entityType:J}))},ot8=function(J,R){this.K=J;
this.J=R;this.V={}},NEk=function(J,R){a:{J=RwK(J.J,R.version);
try{var N=J.J(R.data,R.key);break a}catch(C){yP9(C,h59)}N=void 0}return N},$2=function(J,R,N){return J.K.objectStore("EntityStore").get(R).then(function(C){if(C){if(N&&C.entityType!==N)throw Error("Incorrect entity type");
return NEk(J,C)}})},H4=function(J,R,N){return N?(N=N.map(function(C){return $2(J,C,R)}),g.r9.all(N)):J.K.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(R)).then(function(C){return C.map(function(X){return NEk(J,X)})})},v4=function(J,R,N){var C=lhk(R),X=RwK(J.J,1),u=Object.assign({},R);
return J.K.objectStore("EntityStore").get(C).then(function(f){if(f){if(f.entityType!==N)throw Error("Incorrect entity type");u.entityMetadata||(f=NEk(J,f),u.entityMetadata=f.entityMetadata)}}).then(function(){var f={key:C,
entityType:N,data:bmV(X,u,C),version:1};return g.r9.all([g.zB(J.K.objectStore("EntityStore"),f),CcV(J,u,N)])}).then(function(){k2(J,C,N);
return C})},XKd=function(J,R,N){R=R.map(function(C){return v4(J,C,N)});
return g.r9.all(R)},W4=function(J,R,N){if(N==null?0:N.K8){var C=new Set;
return i$q(J,R,C).then(function(){for(var u=[],f=g.K(C),H=f.next();!H.done;H=f.next())u.push(W4(J,H.value));return g.r9.all(u).then(function(){})})}var X=g.nX(R).entityType;
return g.r9.all([J.K.objectStore("EntityStore").delete(R),uLd(J,R)]).then(function(){k2(J,R,X)})},f$k=function(J,R){return g.bS(J.K.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(R)},function(N){return g.r9.all([N.delete(),
uLd(J,N.cursor.primaryKey)]).then(function(){k2(J,N.cursor.primaryKey,R);return g.yT(N)})})},TEd=function(J,R,N,C){var X=RwK(J.J,1);
return $2(J,R,C).then(function(u){if(u){u=g.zV(u,N);var f={key:R,entityType:C,data:bmV(X,u,R),version:1};return g.r9.all([g.zB(J.K.objectStore("EntityStore"),f),CcV(J,u,C)])}}).then(function(){k2(J,R,C);
return R})},k2=function(J,R,N){var C=J.V[N];
C||(C=new Set,J.V[N]=C);C.add(R)},$hV=function(J,R,N){var C=lhk(R);
N=JXq(N);if(!N)return g.r9.resolve([]);N=new N(R);J=J.K.objectStore("EntityAssociationStore");R=[];N=g.K(N.J());for(var X=N.next();!X.done;X=N.next())R.push(g.zB(J,{parentEntityKey:C,childEntityKey:X.value}));return g.r9.all(R).then(function(u){return u.map(function(f){return f[1]})})},uLd=function(J,R){return J.K.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(R))},CcV=function(J,R,N){var C=lhk(R);
return uLd(J,C).then(function(){return $hV(J,R,N)})},i$q=function(J,R,N){if(N.has(R))return g.r9.resolve(void 0);
N.add(R);return H$V(J,R).then(function(C){return J.K.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(R)).then(function(){return C})}).then(function(C){var X=g.r9.resolve(void 0);
C=g.K(C);for(var u=C.next(),f={};!u.done;f={F5:void 0},u=C.next())f.F5=u.value,X=X.then(function(H){return function(){return i$q(J,H.F5,N)}}(f));
return X}).then(function(){})},H$V=function(J,R){var N=J.K.objectStore("EntityAssociationStore");
return N.index("byParentEntityKey").getAll(IDBKeyRange.only(R)).then(function(C){var X=[];C=g.K(C);for(var u=C.next();!u.done;u=C.next())u=u.value,X.push(N.index("byChildEntityKey").getAll(u.childEntityKey));return g.r9.all(X)}).then(function(C){var X=[];
C=g.K(C);for(var u=C.next();!u.done;u=C.next())u=u.value,u.length===1&&X.push(u[0].childEntityKey);return X})},Sk=function(){},k9_=function(){this.K={};
this.K[0]=new Sk;if(!g.Ac("aes_pes_encoder_killswitch")){var J=this.K;try{var R=g.XU();var N=t4f(R);var C=new TU(new g.pX(N),new g.Ub(N))}catch(X){throw J=X instanceof Error?new fx("KEY_CREATION_FAILED",{PW:X.message}):new fx("KEY_CREATION_FAILED"),g.yD(J),J;}J[1]=C}},RwK=function(J,R){R=R===void 0?0:R;
J=J.K[R];if(!J)throw R=new fx("INVALID_ENCODER_VERSION",{sE:R}),g.yD(R),R;return J},Lx=function(J,R){g.l.call(this);
this.token=J;this.K=R;this.observers=[];J=new g.mB.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.XU());J.onmessage=this.J.bind(this);this.channel=J},I0=function(J,R,N){var C,X,u,f;
return g.Y(function(H){if(H.K==1)return g.q(H,z5d(J.token),2);if(H.K!=3)return C=H.J,g.q(H,g.P9(C,["EntityStore","EntityAssociationStore"],R,function(k){X=new ot8(k,J.K);return N(X)}),3);
u=H.J;X&&(f=X.V,Object.keys(f).length>0&&(J.channel.postMessage(f),vtU(J,f)));return H.return(u)})},F4=function(J,R,N){return I0(J,{mode:"readwrite",
QK:!0},function(C){return v4(C,R,N)})},W5L=function(J,R){return I0(J,{mode:"readwrite",
QK:!0},function(N){return XKd(N,R,"offlineOrchestrationActionWrapperEntity")})},Sp9=function(J,R){return I0(J,{mode:"readwrite",
QK:!0},function(N){return W4(N,R)})},L5q=function(J){return I0(J,{mode:"readwrite",
QK:!0},function(R){return f$k(R,"videoPlaybackPositionEntity")})},EP=function(J,R,N){return I0(J,{mode:"readonly",
QK:!0},function(C){return $2(C,R,N)})},Me=function(J,R,N){return I0(J,{mode:"readonly",
QK:!0},function(C){return H4(C,R,N)})},vtU=function(J,R){J=g.K(J.observers);
for(var N=J.next();!N.done;N=J.next())N=N.value,N(R)},I$a=function(){var J,R,N;
return g.Y(function(C){if(C.K==1)return g.Ef(C,2),g.q(C,g.$s(),4);if(C.K!=2){J=C.J;if(!J||!g.iS()||typeof g.mB.BroadcastChannel==="undefined")return C.return();R=new k9_;return C.return(new Lx(J,R))}N=g.K2(C);N instanceof Error&&g.yD(N);return C.return()})},Kx=function(){F5_||(F5_=I$a());
return F5_},Et9=function(J){var R;
J=(R=J.options)==null?void 0:R.persistenceOption;return J==="ENTITY_PERSISTENCE_OPTION_PERSIST"||J==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},M_a=function(J){var R;
return g.Y(function(N){return N.K==1?g.q(N,Kx(),2):(R=N.J)?g.q(N,I0(R,"readwrite",function(C){for(var X={},u=g.K(J),f=u.next(),H={};!f.done;H={jR:void 0,xG:void 0},f=u.next())H.jR=f.value,H.jR.entityKey&&Et9(H.jR)&&(H.xG=g.OF(H.jR.payload),f=void 0,H.jR.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(f=function(k){return function(){return v4(C,k.jR.payload[k.xG],k.xG)}}(H)),H.jR.type==="ENTITY_MUTATION_TYPE_DELETE"&&(f=function(k){return function(){return W4(C,k.jR.entityKey)}}(H)),H.jR.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(f=function(k){return function(){return TEd(C,k.jR.entityKey,k.jR.payload[k.xG],k.xG)}}(H)),f&&(X[H.jR.entityKey]=X[H.jR.entityKey]?X[H.jR.entityKey].then(f):f()));
return g.r9.all(Object.values(X))}),0):N.return()})},K5E=function(J){var R;
return g.Y(function(N){if(N.K==1){R=J.mutations;if(!R||R.length<=0)return N.return();if(g.I5){var C={type:"ENTITY_LOADED"};R!==void 0&&(C.payload=R);g.I5.dispatch(C)}return g.q(N,M_a(R),2)}R.length=0;g.IQ(N)})},a$K=function(J){return J!==void 0},Qof=function(J){var R=g.Vz();
R=Object.assign({},R);J=Object.assign({},J);for(var N in R)J[N]?(R[N]!==4&&(R[N]=J[N]),delete J[N]):R[N]!==2&&(R[N]=4);Object.assign(R,J);g.LNQ(R);JSON.stringify(R);return R},ntd=function(J){var R,N;
return g.Y(function(C){if(C.K==1)return g.q(C,g.$s(),2);if(C.K!=3)return(R=C.J)?g.q(C,g.pW(R),3):C.return();N=C.J;return C.return(g.P9(N,["index","media","captions"],{mode:"readwrite",QK:!0},function(X){var u=IDBKeyRange.bound(J+"|",J+"~");X=[X.objectStore("index").delete(u),X.objectStore("media").delete(u),X.objectStore("captions").delete(u)];return g.r9.all(X).then(function(){})}))})},DhP=function(){var J,R;
return g.Y(function(N){if(N.K==1)return g.q(N,g.$s(),2);if(N.K!=3){J=N.J;if(!J)throw g.AC("rvdfd");return g.q(N,g.pW(J),3)}R=N.J;return N.return(g.P9(R,["index","media"],{mode:"readwrite",QK:!0},function(C){var X={};return g.hC(C.objectStore("index"),{},function(u){var f=u.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),H=g.r9.resolve(void 0);if(f){var k=f[1];f=f[2];X[k]=X[k]||{};var v;X[k][f]=g.KN2((v=u.getValue())==null?void 0:v.fmts)}else H=u.delete().then(function(){});
return g.r9.all([g.yT(u),H]).then(function(W){return g.K(W).next().value})}).then(function(){for(var u={},f=g.K(Object.keys(X)),H=f.next();!H.done;H=f.next()){H=H.value;
var k=X[H].v;u[H]=X[H].a&&k?1:2}var v=Qof(u);return g.ot2(C.objectStore("media"),{},function(W){var S=W.cursor.key.match(g.DN7);S&&u[S[1]]||C.objectStore("media").delete(W.cursor.key);return g.wp7(W)}).then(function(){return v})})}))})},soJ=function(J,R){var N,C;
return g.Y(function(X){if(X.K==1)return g.q(X,g.$s(),2);if(X.K!=3){N=X.J;if(!N)throw g.AC("wct");return g.q(X,g.pW(N),3)}C=X.J;return g.q(X,g.P9(C,["captions"],{mode:"readwrite",QK:!0},function(u){var f=[];u=u.objectStore("captions");for(var H=0;H<R.length;H++){var k=g.zB(u,R[H],J+"|"+R[H].metadata.vss_id);f.push(k)}return g.r9.all(f)}),0)})},BEJ=function(J){var R,N,C;
return g.Y(function(X){if(X.K==1)return R=IDBKeyRange.bound(J+"|",J+"~"),g.q(X,g.$s(),2);if(X.K!=3){N=X.J;if(!N)throw g.AC("gactfv");return g.q(X,g.pW(N),3)}C=X.J;return X.return(C.getAll("captions",R))})},O$K=function(J){return g.Y(function(R){g.UA(J,0);
return R.return(ntd(J))})},Z$_=function(J){return{context:g.LL(),
videoIds:J}},dhl=function(J){return{context:g.LL(),
playlistIds:J}},qpU=function(J){return{context:g.LL(),
offlinePlaylistSyncChecks:J}},AXP=function(){this.K=new Map},rXU=function(){Ypa||(Ypa=new AXP);
return Ypa},jo_=function(J,R){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:J},metadata:R,statusCode:void 0,csn:void 0,can:void 0}},mha=function(J,R,N){if(!N){var C=C===void 0?!1:C;
N=J.K.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!N||C)N=g.jg(16),J.K.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",N)}J={flowNonce:N,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:R.eventType};R.metadata&&(J.flowMetadata=R.metadata);R.statusCode!==void 0&&(J.flowEventStatus=R.statusCode);R.csn&&(J.csn=R.csn);R.can&&(J.can=R.can);g.Mz("flowEvent",J,void 0)},V_d=function(J){var R,N,C,X,u,f,H,k,v,W,S,L,I,F,a,n,B,Z,A,V,p,b,w,RQ,$E,G,e,t,E,y,b8,FV,Hl,Of,oU,SE,tk,D,O,d;
return g.Y(function(r){if(r.K==1)return g.q(r,I0(J,{mode:"readonly",QK:!0},function(U){return H4(U,"playbackData").then(function(Jk){var i8=Jk.map(function(FB){return FB.transfer}).filter(function(FB){return!!FB}),C2=Jk.map(function(FB){return FB.offlineVideoPolicy}).filter(function(FB){return!!FB}),m=Jk.filter(function(FB){return!!FB.key}).map(function(FB){return g.DR(g.nX(FB.key).entityId,"downloadStatusEntity")});
i8=H4(U,"transfer",i8);C2=H4(U,"offlineVideoPolicy",C2);m=H4(U,"downloadStatusEntity",m);var Hg=i8.then(function(FB){FB=FB.reduce(function(u8,jn){(jn==null?0:jn.offlineVideoStreams)&&u8.push.apply(u8,g.Q(jn.offlineVideoStreams));return u8},[]).filter(function(u8){return!!u8});
return H4(U,"offlineVideoStreams",FB)});
return g.r9.all([i8,C2,Hg,m]).then(function(FB){var u8=g.K(FB);FB=u8.next().value;var jn=u8.next().value;var uP=u8.next().value;u8=u8.next().value;return[Jk,FB,jn,uP,u8]})})}),2);
if(r.K!=3)return R=r.J,g.q(r,I0(J,{mode:"readonly",QK:!0},function(U){return H4(U,"mainDownloadsListEntity").then(function(Jk){var i8,C2;return(C2=(i8=Jk[0])==null?void 0:i8.downloads)!=null?C2:[]})}),3);
N=r.J;C=g.K(R);X=C.next().value;u=C.next().value;f=C.next().value;H=C.next().value;k=C.next().value;v=X;W=u;S=f;L=H;I=k;F={};a={};n={};B={};Z={};A=[];V=g.K(W);for(p=V.next();!p.done;p=V.next())(b=p.value)&&(F[b.key]=b);w=g.K(S);for(RQ=w.next();!RQ.done;RQ=w.next())($E=RQ.value)&&(a[$E.key]=$E);G=g.K(I);for(e=G.next();!e.done;e=G.next())(t=e.value)&&(n[t.key]=t);E=g.K(L);for(y=E.next();!y.done;y=E.next())(b8=y.value)&&(B[b8.key]=b8);FV=g.K(N);for(Hl=FV.next();!Hl.done;Hl=FV.next())Of=Hl.value,oU=void 0,
Z[(oU=Of.videoItem)!=null?oU:""]=!0,Of.videoItem&&(tk=SE=void 0,D=(tk=(SE=g.nX(Of.videoItem))==null?void 0:SE.entityId)!=null?tk:"",A.push({externalVideoId:D}));O=v.filter(function(U){if(!U||!U.key||!U.offlineVideoPolicy)return!1;U=g.nX(U.key).entityId;U=g.DR(U,"downloadStatusEntity");var Jk;return!(U&&((Jk=n[U])==null?void 0:Jk.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
d=O.map(function(U){var Jk=F[U.transfer],i8=[];if(Jk==null?0:Jk.offlineVideoStreams)for(var C2=g.K(Jk.offlineVideoStreams),m=C2.next();!m.done;m=C2.next())(m=B[m.value])&&i8.push(m);C2=a[U.offlineVideoPolicy];m=Z;var Hg=U==null?void 0:U.playerResponseTimestamp,FB=g.nX(C2.key).entityId;U=g.DR(FB,"mainVideoEntity");if(C2.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var u8="OFFLINE_VIDEO_STATE_DISABLED";C2.expirationTimestamp&&Number(C2.expirationTimestamp)<Date.now()/1E3&&(u8="OFFLINE_VIDEO_STATE_EXPIRED")}else if(C2.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")u8="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Jk==null?void 0:Jk.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":u8="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":u8="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":u8="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":u8="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":u8="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":u8="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:u8="OFFLINE_VIDEO_STATE_UNKNOWN"}if(u8==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Jk==null?void 0:Jk.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":u8="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":u8="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":u8=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}FB={id:FB,videoState:u8};if(Jk==null?0:Jk.cotn)FB.cotn=Jk.cotn;if(Jk==null?0:Jk.maximumDownloadQuality)FB.selectedVideoQuality=Jk==null?void 0:Jk.maximumDownloadQuality;if(Jk==null?0:Jk.lastProgressTimeMs)FB.lastProgressTimeMs=Jk.lastProgressTimeMs;Hg&&(FB.playerResponseSavedTimeMs=String(Number(Hg)*1E3));Jk=String;Hg=0;i8=g.K(i8);for(u8=i8.next();!u8.done;u8=i8.next())if(u8=u8.value,u8.streamsProgress){u8=g.K(u8.streamsProgress);for(var jn=u8.next();!jn.done;jn=
u8.next()){var uP=void 0;Hg+=Number((uP=jn.value.numBytesDownloaded)!=null?uP:0)}}FB.downloadedBytes=Jk(Hg);FB.selectedOfflineMode=m[U]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";C2.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(FB.offlinePlaybackDisabledReason=C2.offlinePlaybackDisabledReason);return FB});
return r.return({offlineVideos:d,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:A}}})})},gt9=function(){this.locks=navigator.locks},Uh9=function(){try{var J=g.gY("ytglobal.locks_");
if(J)return J;var R;if(R=navigator){var N=navigator;R="locks"in N&&!!N.locks}if(R)return g.mB.localStorage&&g.mB.localStorage.getItem("noop"),J=new gt9,g.VE("ytglobal.locks_",J),J}catch(C){}},a0=function(){},pKk=function(){},l$E=function(J){if(J.includes(":"))throw Error("Invalid user cache name: "+J);
return J+":"+g.XU("CacheStorage get")},Pck=function(){return g.Y(function(J){if(QQ!==void 0)return J.return(QQ);
QQ=new Promise(function(R){var N;return g.Y(function(C){switch(C.K){case 1:return g.Ef(C,2),g.q(C,nx.open("test-only"),4);case 4:return g.q(C,nx.delete("test-only"),5);case 5:g.MP(C,3);break;case 2:if(N=g.K2(C),N instanceof Error&&N.name==="SecurityError")return R(!1),C.return();case 3:R("caches"in window),g.IQ(C)}})});
return J.return(QQ)})},ew8=function(){return g.Y(function(J){if(J.K==1)return g.q(J,Pck(),2);
if(!J.J)return J.return(void 0);zwf||(zwf=new pKk);return J.return(zwf)})},DY=function(J,R,N){g.G$(new g.C3("Woffle: "+J,N?{cotn:N}:""));
R instanceof Error&&g.G$(R)},wK9=function(J){var R;
return g.Y(function(N){if(N.K==1)return g.q(N,V_d(J),2);R=N.J;g.Mz("offlineStateSnapshot",R);g.IQ(N)})},sP=function(J){g.l.call(this);
var R=this;this.api=J;this.QR={SbM:function(){return R.K},
ap3:function(){return R.J}};
typeof g.mB.BroadcastChannel!=="undefined"&&(this.K=new g.mB.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.XU()),this.K.onmessage=this.V.bind(this),this.J=new g.mB.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.XU()),this.J.onmessage=this.Z.bind(this))},B4=function(J,R){J.api.z7("onOfflineOperationFailure",R);
var N;(N=J.K)==null||N.postMessage(R)},cXU=function(J,R,N,C){var X=this;
this.X=J;this.W=R;this.visibility=N;this.T=C;this.U=this.D=this.S=this.V=this.K=!1;this.Z=new g.$t(function(){X.AQ()});
this.QR={bD:function(){return X.J},
AQ:function(){X.AQ()},
kGk:function(){return X.Z}};
this.visibility.subscribe("visibilitystatechange",function(){X.Fe()})},hwa=function(J){if(!J.V&&!J.K){var R=Uh9();
if(R){J.V=!0;var N=g.XU("OfflineLockManager");R.request("woffle_orchestration_leader:"+N,{},function(){var C,X,u,f;return g.Y(function(H){switch(H.K){case 1:return g.Ef(H,2),J.J=new g.Qt,J.K=!0,J.V=!1,g.q(H,J.X(),4);case 4:return g.q(H,J.J.promise,5);case 5:g.MP(H,0);break;case 2:C=g.K2(H),((u=(X=J).T)==null?0:u.call(X,"wo_relinquish_leadership_on_lock_request_error"))||J.AQ(),C instanceof Error&&(f=C,f.args=[{name:"WoLockManagerError",kF:C.name}],g.yD(f)),g.IQ(H)}})})}}},yXf=function(J){J.K&&(J.U=
!0,OP(J))},G9a=function(J,R){J.K&&(J.S=R,OP(J))},b$U=function(J,R){J.K&&(J.D=R,OP(J))},OP=function(J){J.D&&J.S&&J.U&&J.visibility.isBackground()?g.HK(J.Z,6E4):J.Z.stop()},ZY=function(J){var R;
J.offlineDeleteReason=(R=J.offlineDeleteReason)!=null?R:"OFFLINE_DELETE_REASON_UNKNOWN";var N;J.offlineModeType=(N=J.offlineModeType)!=null?N:"OFFLINE_NOW";g.Mz("offlineDeleteEvent",J)},dR=function(J,R){var N=R.videoId;
var C=R.wU;R=R.offlineModeType;J.encryptedVideoId=N;J.cotn=C==null?void 0:C.cotn;J.offlineabilityFormatType=C==null?void 0:C.maximumDownloadQuality;var X;J.isRefresh=(X=C==null?void 0:C.isRefresh)!=null?X:!1;var u;J.softErrorCount=(u=C==null?void 0:C.transferRetryCount)!=null?u:0;J.offlineModeType=R!=null?R:"OFFLINE_NOW";(J.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&J.statusType==="UNKNOWN_STATUS_TYPE"||!J.transferStatusType&&!J.statusType)&&g.G$(Error("Woffle unknown transfer status"));
g.Mz("offlineTransferStatusChanged",J)},t_V=function(J,R,N,C){C={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!C};R&&N&&(R=Math.floor(R/1024).toFixed(),N=Math.floor(N/1024).toFixed(),C.alreadyDownloadedKbytes=R,C.totalFetchedKbytes=R,C.totalContentKbytes=N);dR(C,J)},xhJ=function(J){dR({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},J)},JHk=function(J){switch(J){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
qe=function(J){var R,N,C;
return((C=(R=J.actionMetadata)==null?void 0:(N=R.retryScheduleIntervalsInSeconds)==null?void 0:N.length)!=null?C:0)>0},Au=function(J){return J.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!J.entityKey},Y2=function(J){return J.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!J.entityKey},rR=function(J){return J.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!J.entityKey},oHl=function(J){return J.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!J.entityKey},
jk=function(J,R,N,C,X){X=X===void 0?!1:X;
var u,f,H,k,v,W;return g.Y(function(S){if(S.K==1)return u=g.DR(J,R),f=g.DR(J,"downloadStatusEntity"),g.q(S,I0(N,{mode:"readonly",QK:!0},function(L){return g.r9.all([$2(L,u,R),$2(L,f,"downloadStatusEntity")])}),2);
H=S.J;k=H.length?H[0]:void 0;if(!k)return S.ZM(0);v=RpE;if(W=H.length>1?H[1]:void 0){if(W.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!X)return S.return();W.downloadState=C}else W={key:f,downloadState:C};g.ol(k,v,W);return g.q(S,I0(N,{mode:"readwrite",QK:!0},function(L){return g.r9.all([v4(L,k,R),v4(L,W,"downloadStatusEntity")])}),0)})},mD=function(J,R){return J.actionType===R.actionType&&J.entityKey===R.entityKey},VQ=function(J,R){if(J&&J.transferState!=="TRANSFER_STATE_COMPLETE"&&J.transferState!==
"TRANSFER_STATE_FAILED"){var N=g.nX(J.key).entityId;
dR({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:N,wU:J,offlineModeType:R})}},gR=function(J){if(!J||!J.thumbnails)return[];
var R=[];J=g.K(J.thumbnails);for(var N=J.next();!N.done;N=J.next())N=N.value,N.url&&R.push(N.url);return R},NlV=function(J,R,N){N=N===void 0?[]:N;
var C,X,u,f,H,k,v,W,S,L,I,F,a;return g.Y(function(n){if(n.K==1)return N.length?g.q(n,Me(J,R),2):n.return([]);C=n.J;X=new Set;u=g.K(C);for(f=u.next();!f.done;f=u.next())if(H=f.value,k=H.id||H.key)v=g.nX(k).entityId,X.add(v);W=[];S=g.K(N);for(L=S.next();!L.done;L=S.next())I=L.value,F=I.offlineVideoData,a=void 0,((a=F)==null?0:a.videoId)&&!X.has(F.videoId)&&W.push(I);return n.return(W)})},CHV=function(J,R,N){return new g.xC(J,{cotn:R,
raw_player_response:N,download_media:!0,start:Infinity,disable_watch_next:!0})},XQP=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},UP=function(J,R,N,C,X,u,f,H,k,v,W){this.entityType=J;
this.actionId=R;this.action=N;this.parentActionId=C;this.rootActionId=X===void 0?R:X;this.childActionIds=u;this.prereqActionId=f;this.postreqActionIds=H;this.hasChildActionFailed=v;this.retryScheduleIndex=0;this.K=W||Date.now();this.retryScheduleIndex=k||0},px=function(J){if(!J.key)throw Error("Entity key is required.");
if(!J.actionProto)throw Error("OfflineOrchestrationAction is required.");var R=g.nX(J.key),N=g.nX(J.actionProto.entityKey);return new UP(N.entityType,R.entityId,J.actionProto,J.parentActionId,J.rootActionId,J.childActionIds,J.prereqActionId,J.postreqActionIds,J.retryScheduleIndex,J.hasChildActionFailed,Number(J.enqueueTimeSec)*1E3)},lQ=function(J){return{key:g.DR(J.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:J.action,parentActionId:J.parentActionId,rootActionId:J.rootActionId,childActionIds:J.childActionIds,prereqActionId:J.prereqActionId,postreqActionIds:J.postreqActionIds,retryScheduleIndex:J.retryScheduleIndex,hasChildActionFailed:J.hasChildActionFailed,enqueueTimeSec:(J.K/1E3).toFixed()}},iak=function(){var J;
return g.Y(function(R){return R.K==1?g.q(R,ew8(),2):(J=R.J)?R.return(J.delete("yt-player-local-img")):R.return(!0)})},P4=function(J){var R,N;
return g.Y(function(C){if(C.K==1)return g.q(C,ew8(),2);if(C.K!=3){R=C.J;if(!R)throw Error("Cache API not supported");return J.length?g.q(C,R.open("yt-player-local-img"),3):C.return()}N=C.J;return g.q(C,Promise.all(J.map(function(X){return N.delete(X)})),0)})},zU=function(J){var R,N;
return g.Y(function(C){if(C.K==1)return g.q(C,ew8(),2);if(C.K!=3){R=C.J;if(!R)throw Error("Cache API not supported");return J.length?g.q(C,R.open("yt-player-local-img"),3):C.return()}N=C.J;return g.q(C,N.addAll(J),0)})},ek=function(J,R,N,C,X){var u,f,H,k,v,W,S,L,I,F,a,n,B,Z,A,V,p,b,w,RQ,$E,G,e,t,E,y,b8,FV,Hl,Of,oU;
return g.Y(function(SE){switch(SE.K){case 1:return u=g.DR(J,"mainVideoEntity"),f=g.DR(J,"ytMainChannelEntity"),H=g.DR(J,"transfer"),k=g.DR(J,"videoDownloadContextEntity"),g.q(SE,I0(R,{mode:"readonly",QK:!0},function(tk){return g.r9.all([$2(tk,u,"mainVideoEntity"),$2(tk,f,"ytMainChannelEntity"),$2(tk,H,"transfer"),$2(tk,k,"videoDownloadContextEntity"),H4(tk,"ytMainChannelEntity"),H4(tk,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:v=SE.J;W=g.K(v);S=W.next().value;L=W.next().value;I=W.next().value;F=W.next().value;a=W.next().value;n=W.next().value;B=S;Z=L;A=I;V=F;p=a;b=n;if(!B&&!Z){SE.ZM(3);break}w=B?gR(B.thumbnail):[];if(!Z){RQ=[];SE.ZM(4);break}return g.q(SE,uZJ(Z,p),5);case 5:RQ=SE.J;case 4:return $E=RQ,g.q(SE,P4(w.concat($E)),3);case 3:G=[];e=g.DR(J,"downloadStatusEntity");t=g.K(b);for(E=t.next();!E.done;E=t.next())y=E.value,b8=g.nX(y.key).entityId,FV=px(y),Hl=g.nX(FV.action.entityKey).entityId,b8!==J&&Hl!==J||mD(N,
y.actionProto)||G.push(y.key);return g.q(SE,I0(R,{mode:"readwrite",QK:!0},function(tk){var D=G.map(function(O){return W4(tk,O)});
D.push(W4(tk,u,{K8:!0}));D.push(W4(tk,e,{K8:!0}));return g.r9.all(D)}),7);
case 7:oU=(Of=V)==null?void 0:Of.offlineModeType,X&&(ZY(X),X.offlineModeType&&(oU=X.offlineModeType)),VQ(A,oU),B4(C,{entityKey:u,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.IQ(SE)}})},$0J=function(J,R,N,C){var X,u,f,H,k,v,W,S,L,I,F,a,n,B,Z,A,V,p,b,w,RQ,$E,G,e,t,E,y,b8,FV,Hl,Of,oU,SE,tk,D,O,d,r,U,Jk,i8,C2,m,Hg,FB,u8,jn,uP,p8,vb;
return g.Y(function(cg){switch(cg.K){case 1:return X=g.DR(J,"mainPlaylistEntity"),u=g.DR(J,"ytMainChannelEntity"),g.q(cg,I0(R,{mode:"readonly",QK:!0},function(mS){return g.r9.all([$2(mS,X,"mainPlaylistEntity"),$2(mS,u,"ytMainChannelEntity"),H4(mS,"mainPlaylistEntity"),H4(mS,"mainDownloadsListEntity"),H4(mS,"ytMainChannelEntity"),H4(mS,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:f=cg.J;H=g.K(f);k=H.next().value;v=H.next().value;W=H.next().value;S=H.next().value;L=H.next().value;I=H.next().value;F=k;a=v;n=W;B=S;Z=L;A=I;if(!F&&!a){cg.ZM(3);break}V=F?f1q(F):[];if(!a){p=[];cg.ZM(4);break}return g.q(cg,uZJ(a,Z),5);case 5:p=cg.J;case 4:return b=p,g.q(cg,P4(V.concat(b)),3);case 3:w=[];RQ=new Map;if(!F){cg.ZM(7);break}return g.q(cg,Tl_(F,n,B),8);case 8:w=cg.J;$E=g.K(w);for(G=$E.next();!G.done;G=$E.next())e=G.value,RQ.set(e,{videoId:e,playlistId:J,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.q(cg,I0(R,{mode:"readonly",QK:!0},function(mS){return g.r9.all([H4(mS,"transfer"),H4(mS,"videoDownloadContextEntity")])}),9);
case 9:t=cg.J;E=g.K(t);y=E.next().value;b8=E.next().value;FV=y;Hl=b8;Of=g.K(FV);for(oU=Of.next();!oU.done;oU=Of.next())SE=oU.value,tk=g.nX(SE.key).entityId,(D=RQ.get(tk))&&SE&&(D.cotn=SE.cotn);O=g.K(Hl);for(d=O.next();!d.done;d=O.next())r=d.value,U=g.nX(r.key).entityId,(Jk=RQ.get(U))&&r&&(Jk.offlineModeType=r.offlineModeType);case 7:i8=[];C2=g.K(A);for(m=C2.next();!m.done;m=C2.next())Hg=m.value,FB=g.nX(Hg.key).entityId,u8=px(Hg),FB!==J&&u8.rootActionId!==J||mD(N,Hg.actionProto)||i8.push(Hg.key);jn=
g.DR(J,"mainPlaylistEntity");return g.q(cg,I0(R,{mode:"readwrite",QK:!0},function(mS){var vh=i8.map(function(li){return W4(mS,li)});
vh.push(W4(mS,jn,{K8:!0}));return g.r9.all(vh)}),10);
case 10:if(!F){cg.ZM(0);break}w.reverse();if(!w){cg.ZM(0);break}uP=g.K(w);p8=uP.next();case 13:if(p8.done){cg.ZM(0);break}vb=p8.value;return g.q(cg,ek(vb,R,N,C,RQ.get(vb)),14);case 14:p8=uP.next(),cg.ZM(13)}})},k6a=function(J,R,N,C){var X,u,f,H,k,v,W,S,L;
return g.Y(function(I){if(I.K==1)return X=g.DR("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),u=new Map,g.q(I,I0(J,{mode:"readwrite",QK:!0},function(F){var a=H4(F,"transfer"),n=H4(F,"offlineOrchestrationActionWrapperEntity"),B=H4(F,"videoDownloadContextEntity"),Z=$2(F,X,"mainDownloadsListEntity");return g.r9.all([a,n,B,Z]).then(function(A){A=g.K(A);var V=A.next().value;var p=A.next().value;var b=A.next().value;var w=A.next().value;A=HaP.map(function($E){return f$k(F,$E)});
p=g.K(p);for(var RQ=p.next();!RQ.done;RQ=p.next())RQ=RQ.value,mD(R,RQ.actionProto)||A.push(W4(F,RQ.key,{K8:!0}));w&&(w.downloads=[],A.push(v4(F,w,"mainDownloadsListEntity")));if(b)for(b=g.K(b),w=b.next();!w.done;w=b.next())w=w.value,p=g.nX(w.key).entityId,p=g.DR(p,"transfer"),u.set(p,w.offlineModeType);return g.r9.all(A).then(function(){return V})})}),2);
f=I.J;H=g.K(f);for(k=H.next();!k.done;k=H.next())v=k.value,VQ(v,u.get(v.key)),W=g.nX(v.key).entityId,S={videoId:W,offlineDeleteReason:C,cotn:v.cotn,offlineModeType:u.get(v.key)},ZY(S),L=g.DR(W,"mainVideoEntity"),B4(N,{entityKey:L,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.q(I,iak(),0)})},f1q=function(J,R){var N=[];
if(J.thumbnailStyleData){J=g.K(J.thumbnailStyleData);for(var C=J.next();!C.done;C=J.next()){var X=void 0,u=void 0,f=void 0;N=N.concat(gR((X=C.value)==null?void 0:(u=X.value)==null?void 0:(f=u.collageThumbnail)==null?void 0:f.coverThumbnail))}}R=gR(R);return N.concat(R)},Tl_=function(J,R,N){var C,X,u,f,H,k,v,W,S,L,I,F,a,n,B,Z,A,V,p,b,w,RQ,$E;
return g.Y(function(G){C=[];X=new Set;if(N.length)for(u=g.K(N),f=u.next();!f.done;f=u.next())if(H=f.value,k=void 0,(k=H.downloads)==null?0:k.length)for(v=g.K(H.downloads),W=v.next();!W.done;W=v.next())S=W.value,S.videoItem&&(L=g.nX(S.videoItem).entityId,X.add(L));if(J.videos){I=g.K(J.videos);for(F=I.next();!F.done;F=I.next())a=F.value,n=JSON.parse(g.nX(a).entityId),n.videoId&&!X.has(n.videoId)&&C.push(n.videoId);B=g.K(R);for(Z=B.next();!Z.done;Z=B.next())if(A=Z.value,A.key!==J.key&&(V=A.videos))for(p=
g.K(V),b=p.next();!b.done;b=p.next())w=b.value,RQ=JSON.parse(g.nX(w).entityId),RQ.videoId&&($E=C.indexOf(RQ.videoId),$E!==-1&&C.splice($E,1))}return G.return(C)})},uZJ=function(J,R){var N,C,X,u,f,H,k,v;
return g.Y(function(W){N=gR(J.avatar);C=g.K(R);for(X=C.next();!X.done;X=C.next())if(u=X.value,u.id!==J.id)for(f=g.K(gR(u.avatar)),H=f.next();!H.done;H=f.next())k=H.value,v=N.indexOf(k),v!==-1&&N.splice(v,1);return W.return(N)})},vHJ=function(J){var R;
return g.Y(function(N){R=g.z(J.frameworkUpdates,wR);return J.frameworkUpdates&&R?g.q(N,K5E(R),0):N.return()})},S0a=function(J){var R;
if((R=J.onResponseReceivedActions)!=null&&R.length){var N;J=(N=g.z(g.z(J.onResponseReceivedActions[0],W68),g.EmP))==null?void 0:N.actions;if(J!=null&&J.length)return J}},L6f=function(J){var R,N,C;
return g.Y(function(X){if(X.K==1)return J?g.q(X,EP(J,g.$_,"mainDownloadsListEntity"),2):X.return([]);R=X.J;return((N=R)==null?0:(C=N.downloads)==null?0:C.length)?X.return(R.downloads.map(function(u){var f;return(f=u.videoItem)!=null?f:""})):X.return([])})},F6V=function(J,R){var N;
return g.Y(function(C){return C.K==1?g.q(C,I1_(J,R),2):(N=C.J)?g.q(C,I0(J,{mode:"readwrite",QK:!0},function(X){var u=[v4(X,N.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];N.mainDownloadsListEntity&&u.push(v4(X,N.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.r9.all(u)}),0):C.ZM(0)})},I1_=function(J,R){var N,C,X,u,f,H,k,v,W,S,L,I,F,a,n,B,Z,A;
return g.Y(function(V){if(V.K==1)return N=g.DR("main_downloads_library_id","mainDownloadsLibraryEntity"),C=g.DR("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.q(V,I0(J,{mode:"readonly",QK:!0},function(p){return g.r9.all([$2(p,N,"mainDownloadsLibraryEntity"),$2(p,C,"mainDownloadsListEntity")])}),2);
X=V.J;u=g.K(X);f=u.next().value;H=u.next().value;k=f;v=H;k||(k={id:N});W=g.K(R);for(S=W.next();!S.done;S=W.next())if(L=S.value,L===g.$_){if(k.smartDownloadsList)return V.return();k.smartDownloadsList=L}else if(I=g.nX(L).entityType,F={},I==="mainPlaylistEntity"?F.playlistItem=L:I==="mainVideoEntity"&&(F.videoItem=L),!g.rq(F)){a=void 0;if((a=v)==null?0:a.downloads){n=!1;B=g.K(v.downloads);for(Z=B.next();!Z.done;Z=B.next())if(A=Z.value,A.playlistItem===L||A.videoItem===L){n=!0;break}n||v.downloads.push(F)}else v=
{id:C,downloads:[F]};k.downloadsList=C}return V.return({mainDownloadsLibraryEntity:k,mainDownloadsListEntity:v})})},EHV=function(J,R){var N,C,X,u,f,H,k,v,W,S,L,I,F,a,n;
return g.Y(function(B){if(B.K==1)return N=g.DR("main_downloads_library_id","mainDownloadsLibraryEntity"),C=g.DR("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.q(B,I0(J,{mode:"readonly",QK:!0},function(Z){return g.r9.all([$2(Z,N,"mainDownloadsLibraryEntity"),$2(Z,C,"mainDownloadsListEntity"),$2(Z,g.$_,"mainDownloadsListEntity")])}),2);
X=B.J;u=g.K(X);f=u.next().value;H=u.next().value;k=u.next().value;v=f;W=H;S=k;if(!v)return B.ZM(0);if(R===g.$_&&((L=S)==null?0:L.downloads))S.downloads=[];else if((I=W)==null?0:I.downloads)for(F=g.nX(R).entityType,a=0;a<W.downloads.length;a++)if(n=W.downloads[a],F==="mainVideoEntity"&&n.videoItem===R){W.downloads.splice(a,1);break}else if(F==="mainPlaylistEntity"&&n.playlistItem===R){W.downloads.splice(a,1);break}return g.q(B,I0(J,{mode:"readwrite",QK:!0},function(Z){var A=[v4(Z,v,"mainDownloadsLibraryEntity")];
W&&A.push(v4(Z,W,"mainDownloadsListEntity"));S&&A.push(v4(Z,S,"mainDownloadsListEntity"));return g.r9.all(A)}),0)})},c4=function(J,R){var N,C,X,u,f,H,k,v,W,S,L;
return g.Y(function(I){if(I.K==1)return N=g.DR(R,"transfer"),C=g.DR(R,"videoDownloadContextEntity"),g.q(I,I0(J,{mode:"readonly",QK:!0},function(F){return g.r9.all([$2(F,N,"transfer"),$2(F,C,"videoDownloadContextEntity")])}),2);
X=I.J;u=g.K(X);f=u.next().value;H=u.next().value;k=f;v=H;L={videoId:R,cotn:(W=k)==null?void 0:W.cotn,offlineModeType:(S=v)==null?void 0:S.offlineModeType};return I.return(L)})},hu=function(J,R,N,C,X){var u,f,H,k,v,W,S,L,I,F,a,n,B,Z,A,V,p,b,w,RQ;
return g.Y(function($E){switch($E.K){case 1:return u=g.DR(J,"musicTrack"),f=g.DR(J,"transfer"),g.q($E,I0(R,{mode:"readonly",QK:!0},function(G){return g.r9.all([$2(G,u,"musicTrack"),$2(G,f,"transfer"),H4(G,"musicTrack"),H4(G,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:H=$E.J;k=g.K(H);v=k.next().value;W=k.next().value;S=k.next().value;L=k.next().value;I=v;F=W;a=S;n=L;if(!I){$E.ZM(3);break}return g.q($E,MWa(I,a),4);case 4:return B=$E.J,g.q($E,P4(B),3);case 3:Z=[];A=g.K(n);for(V=A.next();!V.done;V=A.next())p=V.value,b=g.nX(p.key).entityId,w=px(p),RQ=g.nX(w.action.entityKey).entityId,b!==J&&RQ!==J||mD(N,p.actionProto)||Z.push(p.key);return g.q($E,I0(R,{mode:"readwrite",QK:!0},function(G){var e=Z.map(function(t){return W4(G,t)});
e.push(W4(G,u,{K8:!0}));return g.r9.all(e)}),6);
case 6:VQ(F),X&&ZY(X),B4(C,{entityKey:u,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.IQ($E)}})},yQ=function(J,R,N,C,X){var u,f,H,k,v,W,S,L,I,F,a,n,B,Z,A,V,p,b,w,RQ,$E,G,e,t,E,y,b8,FV,Hl,Of,oU,SE,tk,D,O,d;
return g.Y(function(r){switch(r.K){case 1:return u=g.DR(J,R),f=g.DR("music_downloads_library_id","musicDownloadsLibraryEntity"),g.q(r,I0(N,{mode:"readonly",QK:!0},function(U){return g.r9.all([$2(U,u,R),$2(U,f,"musicDownloadsLibraryEntity"),H4(U,R),H4(U,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:H=r.J;k=g.K(H);v=k.next().value;W=k.next().value;S=k.next().value;L=k.next().value;I=v;F=W;a=S;n=L;if(!I){r.ZM(3);break}return g.q(r,MWa(I,a),4);case 4:return B=r.J,g.q(r,P4(B),3);case 3:Z=[];A=new Map;if(!I){r.ZM(6);break}return g.q(r,K6V(I,a,F),7);case 7:Z=r.J;V=g.K(Z);for(p=V.next();!p.done;p=V.next())b=p.value,w=g.nX(b).entityId,A.set(w,{videoId:w,playlistId:J,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.q(r,Me(N,"transfer"),8);case 8:for(RQ=r.J,$E=g.K(RQ),
G=$E.next();!G.done;G=$E.next())e=G.value,t=g.nX(e.key).entityId,(E=A.get(t))&&e&&(E.cotn=e.cotn);case 6:y=[];b8=g.K(n);for(FV=b8.next();!FV.done;FV=b8.next())Hl=FV.value,Of=g.nX(Hl.key).entityId,oU=px(Hl),Of!==J&&oU.rootActionId!==J||mD(C,Hl.actionProto)||y.push(Hl.key);SE=g.DR(J,R);return g.q(r,I0(N,{mode:"readwrite",QK:!0},function(U){var Jk=y.map(function(i8){return W4(U,i8)});
Jk.push(W4(U,SE,{K8:!0}));return g.r9.all(Jk)}),9);
case 9:if(!I){r.ZM(0);break}Z.reverse();if(!Z.length){r.ZM(0);break}tk=g.K(Z);D=tk.next();case 12:if(D.done){r.ZM(0);break}O=D.value;d=g.nX(O).entityId;if(!d){r.ZM(13);break}return g.q(r,hu(d,N,C,X,A.get(d)),13);case 13:D=tk.next(),r.ZM(12)}})},GU=function(J,R,N){var C,X,u,f,H,k,v;
return g.Y(function(W){if(W.K==1)return g.q(W,I0(J,{mode:"readwrite",QK:!0},function(S){var L=H4(S,"transfer"),I=H4(S,"offlineOrchestrationActionWrapperEntity");return g.r9.all([L,I]).then(function(F){F=g.K(F);var a=F.next().value;var n=F.next().value;F=a1E.map(function(V){return f$k(S,V)});
n=g.K(n);for(var B=n.next();!B.done;B=n.next()){B=B.value;var Z=g.nX(B.actionProto.entityKey).entityType==="musicTrack",A=B.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";mD(R,B.actionProto)||Z&&(!Z||A)||F.push(W4(S,B.key,{K8:!0}))}return g.r9.all(F).then(function(){return a})})}),2);
C=W.J;X=g.K(C);for(u=X.next();!u.done;u=X.next())f=u.value,VQ(f),H=g.nX(f.key).entityId,k={videoId:H,offlineDeleteReason:void 0,cotn:f.cotn},ZY(k),v=g.DR(H,"musicTrack"),B4(N,{entityKey:v,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.q(W,iak(),0)})},QpE=function(J){for(var R,N=g.K(J.additionalMetadatas),C=N.next();!C.done;C=N.next())C=C.value,C.offlineMusicVideoData&&(R=C.offlineMusicVideoData);
var X,u,f,H,k;return{id:g.DR(J.videoId,"musicTrack"),videoId:J.videoId,title:J.title,thumbnailDetails:J.thumbnail,lengthMs:String(Number(J.lengthSeconds)*1E3),albumTitle:(X=R)==null?void 0:X.releaseTitle,musicVideoType:(u=R)==null?void 0:u.musicVideoType,contentRating:{explicitType:(f=R)==null?void 0:f.explicitType},artistNames:((H=R)==null?void 0:H.byline)||((k=R)==null?void 0:k.channelName),downloadMetadata:g.DR(J.videoId,"musicTrackDownloadMetadataEntity")}},K6V=function(J,R,N){var C,X,u,f,H,k,
v,W,S,L,I,F,a,n,B,Z,A,V;
return g.Y(function(p){C=[];X=new Set;if((u=N)==null?0:(f=u.downloadedTracks)==null?0:f.length)for(H=g.K(N.downloadedTracks),k=H.next();!k.done;k=H.next())v=k.value,X.add(v);if(J.tracks){W=g.K(J.tracks);for(S=W.next();!S.done;S=W.next())L=S.value,X.has(L)||C.push(L);I=g.K(R);for(F=I.next();!F.done;F=I.next())if(a=F.value,a.id!==J.id&&(n=a.tracks))for(B=g.K(n),Z=B.next();!Z.done;Z=B.next())A=Z.value,V=C.indexOf(A),V!==-1&&C.splice(V,1)}return p.return(C)})},MWa=function(J,R){var N,C,X,u,f,H,k,v;
return g.Y(function(W){N=gR(J.thumbnailDetails);C=g.K(R);for(X=C.next();!X.done;X=C.next())if(u=X.value,u.id!==J.id)for(f=g.K(gR(u.thumbnailDetails)),H=f.next();!H.done;H=f.next())k=H.value,v=N.indexOf(k),v!==-1&&N.splice(v,1);return W.return(N)})},nHP=function(J,R){var N,C,X,u,f,H,k,v,W;
return g.Y(function(S){if(S.K==1)return N=g.DR("music_downloads_library_id","musicDownloadsLibraryEntity"),g.q(S,EP(J,N,"musicDownloadsLibraryEntity"),2);(C=S.J)||(C={id:N});X=g.nX(R).entityType;X==="musicTrack"?(u=C.downloadedTracks)!=null&&u.includes(R)||(C.downloadedTracks=((f=C.downloadedTracks)!=null?f:[]).concat(R)):X==="musicPlaylist"?(H=C.downloadedPlaylists)!=null&&H.includes(R)||(C.downloadedPlaylists=((k=C.downloadedPlaylists)!=null?k:[]).concat(R)):X!=="musicAlbumRelease"||(v=C.downloadedAlbumReleases)!=
null&&v.includes(R)||(C.downloadedAlbumReleases=((W=C.downloadedAlbumReleases)!=null?W:[]).concat(R));return g.q(S,F4(J,C,"musicDownloadsLibraryEntity"),0)})},D0k=function(J,R){var N,C,X,u,f,H,k;
return g.Y(function(v){if(v.K==1)return N=g.DR("music_downloads_library_id","musicDownloadsLibraryEntity"),g.q(v,EP(J,N,"musicDownloadsLibraryEntity"),2);C=v.J;if(!C)return v.ZM(0);X=g.nX(R).entityType;X==="musicTrack"?u=C.downloadedTracks:X==="musicPlaylist"&&(u=C.downloadedPlaylists);if((f=u)==null?0:f.length)for(H=0;H<u.length;H++)if(k=u[H],k===R){u.splice(H,1);break}return g.q(v,F4(J,C,"musicDownloadsLibraryEntity"),0)})},spE=function(J){var R=J.videos;
J=[];var N=[];if(R){R=g.K(R);for(var C=R.next();!C.done;C=R.next()){var X=C.value.offlineVideoData.videoId;C=g.DR(X,"musicTrack");X=g.DR(X,"musicTrackDownloadMetadataEntity");J.push(C);N.push(X)}}return{Kv:J,wA:N}},bQ=function(J,R,N){R={track:QpE(R)};
N&&(R.playlistId=N);if(J=g.z(J.actionMetadata,BlL))R.maximumDownloadQuality=J.maximumDownloadQuality;return{musicTrackEntityActionMetadata:R}},Zak=function(J){var R,N,C,X,u,f,H,k;
return g.Y(function(v){switch(v.K){case 1:return R=g.AM(),N=Z$_(J),C=g.Em(Oa8),g.Ef(v,2),u={rC:!0},g.q(v,g.Kn(R,N,C,void 0,u),4);case 4:X=v.J;g.MP(v,3);break;case 2:f=g.K2(v);if(f instanceof g.Zw)throw H="GetOffline network manager error: "+f.message,DY(H,f),Error(H);DY("GetOffline fetch request error",f);throw Error("GetOffline fetch request error");case 3:k=tu(X);if(!X)throw DY("Network request failed"),Error("Network request failed");if(k!==void 0)x2(k);else if(!X.videos||!X.videos.length)throw DY("No data"),
Error("No data");return v.return(X.videos.map(function(W){return W.offlineVideoData}))}})},d0J=function(J){var R,N,C,X,u,f,H,k;
return g.Y(function(v){switch(v.K){case 1:return R=g.AM(),N=dhl(J),C=g.Em(Oa8),g.Ef(v,2),u={rC:!0},g.q(v,g.Kn(R,N,C,void 0,u),4);case 4:X=v.J;g.MP(v,3);break;case 2:f=g.K2(v);if(f instanceof g.Zw)throw H="GetOffline network manager error for playlist: "+f.message,DY(H,f),Error(H);DY("GetOffline fetch request error for playlist",f);throw Error("GetOffline fetch request error for playlist");case 3:k=tu(X);if(!X)throw DY("Network request failed for playlist"),Error("Network request failed for playlist");
if(k!==void 0)x2(k,"playlist");else if(!X.playlists||!X.playlists.length)throw DY("No data for playlist"),Error("No data for playlist");return v.return(X.playlists.map(function(W){return W.offlinePlaylistData}))}})},AHq=function(J,R,N,C){var X,u,f,H,k,v,W,S,L,I,F,a,n,B,Z,A,V,p,b,w,RQ,$E,G,e,t,E,y,b8,FV,Hl;
return g.Y(function(Of){switch(Of.K){case 1:return g.q(Of,Kx(),2);case 2:X=Of.J;if(!X)return Of.return([]);u=[];if((f=C)==null?0:f.length){u=C;Of.ZM(3);break}return g.q(Of,Me(X,"mainPlaylistEntity"),4);case 4:u=Of.J;case 3:if(!u.length)return Of.return([]);H=[];k=Date.now()/1E3;v=g.K(u);W=v.next();case 5:if(W.done)return H.length?g.q(Of,q0J(H),10):Of.return([]);S=W.value;if(!S.downloadState){L=void 0;Of.ZM(8);break}return g.q(Of,EP(X,S.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:L=
Of.J;case 8:I=L;F=void 0;n=(a=(F=S)==null?void 0:F.entityMetadata)&&a.nextAutoRefreshIntervalSeconds?Number(a.nextAutoRefreshIntervalSeconds):NaN;B=Number.isNaN(n)?J:n;A=Z=void 0;V=((Z=I)==null?0:Z.lastSyncedTimestampMillis)?Number((A=I)==null?void 0:A.lastSyncedTimestampMillis)/1E3:0;b=p=void 0;w=((p=I)==null?0:p.addedTimestampMillis)?Number((b=I)==null?void 0:b.addedTimestampMillis)/1E3:0;if(N||!a||V+B<=k){RQ=[];$E=void 0;if(($E=S.videos)==null?0:$E.length)for(G=g.K(S.videos),e=G.next();!e.done;e=
G.next())t=e.value,E=JSON.parse(g.nX(t).entityId),E.videoId&&RQ.push(E.videoId);y="0";a&&(b8=void 0,y=String(Number((b8=a.offlineLastModifiedTimestampSeconds)!=null?b8:0).toFixed()));FV={playlistId:S.playlistId,videoIds:RQ,offlineLastModifiedTimestamp:y,autoSync:R,offlineDateAddedTimestamp:String(w.toFixed())};H.push(FV)}W=v.next();Of.ZM(5);break;case 10:return Hl=Of.J,Of.return(Hl)}})},Y0E=function(){var J,R,N,C,X;
return g.Y(function(u){if(u.K==1)return g.q(u,Kx(),2);if(u.K!=3)return(J=u.J)?g.q(u,Me(J,"refresh"),3):u.return(!1);R=u.J;if((N=R[0])==null||!N.refreshTime)return u.return(!1);C=Number(R[0].refreshTime);X=Date.now()/1E3;return u.return(isFinite(C)&&X>=C)})},jp_=function(J,R){var N,C,X;
return g.Y(function(u){switch(u.K){case 1:return g.Ef(u,2),g.q(u,rH_(J,R),4);case 4:return C=u.J,g.q(u,vHJ(C),5);case 5:N=S0a(C);g.MP(u,3);break;case 2:X=g.K2(u),DY("getAndProcessSmartDownloadsResponse request or processing error",X);case 3:return u.return(N)}})},m0f=function(J,R,N,C){var X,u,f,H,k,v,W,S,L,I,F,a,n,B,Z,A,V,p,b,w,RQ,$E,G,e,t,E,y,b8,FV,Hl;
return g.Y(function(Of){switch(Of.K){case 1:return g.q(Of,Kx(),2);case 2:X=Of.J;if(!X)return Of.return([]);u=[];if((f=C)==null?0:f.length){u=C;Of.ZM(3);break}return g.q(Of,Me(X,"musicPlaylist"),4);case 4:u=Of.J;case 3:if(!u.length)return Of.return([]);H=[];k=Date.now()/1E3;v=g.K(u);W=v.next();case 5:if(W.done)return H.length?g.q(Of,q0J(H),10):Of.return([]);S=W.value;L=void 0;F=(I=(L=S)==null?void 0:L.entityMetadata)&&I.nextAutoRefreshIntervalSeconds?Number(I.nextAutoRefreshIntervalSeconds):NaN;a=
Number.isNaN(F)?J:F;B=n=0;Z="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!S.downloadMetadata){Of.ZM(8);break}return g.q(Of,EP(X,S.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:A=Of.J,p=V=void 0,n=Number((p=(V=A)==null?void 0:V.addedTimestampMillis)!=null?p:"0")/1E3,w=b=void 0,B=Number((w=(b=A)==null?void 0:b.lastModifiedTimestampMillis)!=null?w:"0")/1E3,$E=RQ=void 0,Z=($E=(RQ=A)==null?void 0:RQ.syncState)!=null?$E:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:G=void 0;if(N||Z!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!I||Number((G=I.lastSyncedTimestampSeconds)!=null?G:0)+a<=k){e=[];t=void 0;if((t=S.tracks)==null?0:t.length)for(E=g.K(S.tracks),y=E.next();!y.done;y=E.next())b8=y.value,e.push(g.nX(b8).entityId);FV={playlistId:S.playlistId,videoIds:e,offlineLastModifiedTimestamp:String(B.toFixed()),autoSync:R,offlineDateAddedTimestamp:String(n.toFixed())};H.push(FV)}W=v.next();Of.ZM(5);break;case 10:return Hl=Of.J,Of.return(Hl)}})},rH_=function(J,R){var N,C,X,u,f,H,k,v,W,S;
return g.Y(function(L){switch(L.K){case 1:return N=g.AM(),g.q(L,Kx(),2);case 2:C=L.J;if(!C){L.ZM(3);break}return g.q(L,V_d(C),4);case 4:X=L.J;case 3:var I=X;u={context:g.LL(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:J},offlineClientState:I,clientStateRequestData:{preferredFormatType:R}}}};f=g.Em(VWP);g.Ef(L,5);k={rC:!0};return g.q(L,g.Kn(N,u,f,void 0,k),7);case 7:H=L.J;g.MP(L,6);break;case 5:v=g.K2(L);if(v instanceof g.Zw)throw W=
"DPS network manager error for smart downloads: "+v.message,DY(W,v),Error(W);DY("DPS fetch request error for smart downloads",v);throw Error("DPS fetch request error for smart downloads");case 6:S=tu(H);if(H)S!==void 0&&x2(S,"smart downloads");else throw DY("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return L.return(H)}})},U0l=function(J,R){var N,C,X,u,f,H,k,v;
return g.Y(function(W){switch(W.K){case 1:return N=g.AM(),C={context:g.LL(),videoPlaybackPositionEntities:J,lastSyncTimestampUsec:R},X=g.Em(gH8),g.Ef(W,2),f={rC:!0},g.q(W,g.Kn(N,C,X,void 0,f),4);case 4:u=W.J;g.MP(W,3);break;case 2:H=g.K2(W);if(H instanceof g.Zw)throw k="VPPS network manager error: "+H.message,DY(k,H),Error(k);DY("VPPS fetch request error",H);throw Error("VPPS fetch request error");case 3:v=tu(u);if(u)v!==void 0&&x2(v,"position sync");else throw DY("Network request failed for position sync"),
Error("Network request failed for position sync");return W.return(u)}})},l1d=function(J,R,N){var C,X,u,f,H,k,v,W;
return g.Y(function(S){switch(S.K){case 1:C=g.AM();var L=N.refreshData,I=N.isEnqueuedForExpiredStreamUrlRefetch,F=N.rA,a=N.offlineSourceData,n=N.mediaCapabilities,B={entityKey:J};L&&(B.refreshData=L);I&&(B.isExpiredStreamUrlRefetch=I);F&&(B.downloadParameters=F);a&&(B.offlineSourceData=a);L={context:g.R3E(R),signatureTimestamp:20062,videos:[B]};n&&(L.mediaCapabilities=n);X=L;u=g.Em(pQ9);g.Ef(S,2);H={rC:!0};return g.q(S,g.Kn(C,X,u,void 0,H),4);case 4:f=S.J;g.MP(S,3);break;case 2:k=g.K2(S);if(k instanceof
g.Zw)throw v="GetPDE network manager error: "+k.message,DY(v,k),Error(v);DY("GetPDE fetch request error",k);throw Error("GetPDE fetch request error");case 3:W=tu(f);if(f)W!==void 0&&x2(W,"PDE");else throw DY("Network request failed for PDE"),Error("Network request failed for PDE");return S.return(f)}})},tu=function(J){var R;
return(R=J.errorMetadata)==null?void 0:R.status},x2=function(J,R){R=R?" for "+R:"";
if(J===0)throw J="Empty response body"+R,DY(J),Error(J);J="Response with error"+R;DY(J);throw Error(J);},q0J=function(J){var R,N,C,X,u,f,H,k;
return g.Y(function(v){switch(v.K){case 1:return R=g.AM(),N=qpU(J),C=g.Em(PH9),g.Ef(v,2),u={rC:!0},g.q(v,g.Kn(R,N,C,void 0,u),4);case 4:X=v.J;g.MP(v,3);break;case 2:f=g.K2(v);if(f instanceof g.Zw)throw H="offlinePlaylistSyncCheck network manager error: "+f.message,DY(H,f),Error(H);DY("offlinePlaylistSyncCheck fetch request error",f);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:k=tu(X);if(!X)throw DY("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(k!==void 0)x2(k,"playlist sync");else if(!X.offlinePlaylistSyncCheckDatas||!X.offlinePlaylistSyncCheckDatas.length)throw DY("No data for playlist sync"),Error("No data for playlist sync");return v.return(X.offlinePlaylistSyncCheckDatas.map(function(W){return W.offlinePlaylistSyncCheckData}))}})},Ji=function(J){this.K=J},zp_=function(J,R){var N,C,X,u,f,H;
return g.Y(function(k){switch(k.K){case 1:N=new Map,C=g.K(R),X=C.next();case 2:if(X.done){k.ZM(4);break}u=X.value;f=N;H=f.set;return g.q(k,J.J(u),5);case 5:H.call(f,u,k.J);X=C.next();k.ZM(2);break;case 4:return k.return(N)}})},o7=function(J,R,N,C,X,u){R=g.DR(R,N);
C=Object.assign({},u,{priority:C,retryScheduleIntervalsInSeconds:X});return{actionType:J,entityKey:R,actionMetadata:C}},R7=function(J,R,N,C,X,u){this.status=J;
this.K=R;this.Z=N;this.J=C;this.V=X;this.downloadState=u},epl=function(J,R,N){this.K=J;
this.KC=R;this.V=N},hpq=function(J,R){var N,C,X,u,f,H,k,v,W;
return g.Y(function(S){switch(S.K){case 1:return N=R.entityKey,X=(C=g.z(R.actionMetadata,NG))==null?void 0:C.isEnqueuedForExpiredStreamUrlRefetch,g.Ef(S,2),u=void 0,g.q(S,wQk(J,R),4);case 4:u=S.J;g.Ef(S,5);var L=(L=g.z(R.actionMetadata,NG))?{maximumDownloadQuality:L.maximumDownloadQuality}:void 0;return g.q(S,l1d(N,J.KC,{isEnqueuedForExpiredStreamUrlRefetch:X,rA:L,offlineSourceData:u}),7);case 7:f=S.J;g.MP(S,6,2);break;case 5:return g.K2(S,2),H=qe(R)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",DY("PDE handleAdd error"),S.return(Cd(R,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",H,"DOWNLOAD_STATE_FAILED"));case 6:return g.q(S,cH9(J,f,R),8);case 8:return S.return(Cd(R,!0,f.orchestrationActions));case 2:return k=g.K2(S),v="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k instanceof g.B9&&k.type==="QUOTA_EXCEEDED"&&(v="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
W="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),DY("PDE handleAdd error"),S.return(Cd(R,!1,void 0,v,W,"DOWNLOAD_STATE_FAILED"))}})},baq=function(J,R){var N,C,X,u,f,H,k,v,W,S,L,I,F,a,n,B,Z,A,V,p,b,w,RQ,$E;
return g.Y(function(G){switch(G.K){case 1:return N=R.entityKey,C=g.nX(N).entityId,g.q(G,I0(J.K,{mode:"readonly",QK:!0},function(e){var t=$2(e,N,"playbackData"),E=$2(e,g.DR(C,"offlineVideoPolicy"),"offlineVideoPolicy");e=$2(e,g.DR(C,"transfer"),"transfer");return g.r9.all([t,E,e])}),2);
case 2:X=G.J;u=g.K(X);f=u.next().value;H=u.next().value;k=u.next().value;v=f;W=H;S=k;if(!v||!W)return G.return(Cd(R,!0));L=[];a=((F=v)==null?0:F.playerResponseJson)?JSON.parse(v.playerResponseJson):null;if(!(S&&a&&J.KC.T("html5_refresh_deprecated_downloads"))){G.ZM(3);break}I=yHk(J,a,S);return g.q(G,G6d(J,S),4);case 4:L=G.J;case 3:n={lastPlayerResponseTimestampSeconds:v.playerResponseTimestamp,offlineToken:W.offlineToken,formatIds:L};B={};if((Z=S)==null?0:Z.maximumDownloadQuality)B.maximumDownloadQuality=
S.maximumDownloadQuality;g.Ef(G,5);A=void 0;return g.q(G,wQk(J,R),7);case 7:return A=G.J,g.Ef(G,8),g.q(G,l1d(N,J.KC,{refreshData:n,rA:B,offlineSourceData:A,mediaCapabilities:I}),10);case 10:V=G.J;g.MP(G,9,5);break;case 8:return g.K2(G,5),p=qe(R)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",DY("PDE handleRefresh error"),G.return(Cd(R,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",p,"DOWNLOAD_STATE_FAILED"));
case 9:return g.q(G,cH9(J,V,R),11);case 11:return G.return(Cd(R,!0,V.orchestrationActions));case 5:return b=g.K2(G),w="PDE handleRefresh error",b instanceof Error&&(w="PDE handleRefresh error: "+b.message),RQ="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",$E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.B9&&b.type==="QUOTA_EXCEEDED"&&(RQ="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",$E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),DY(w),G.return(Cd(R,
!1,void 0,RQ,$E,"DOWNLOAD_STATE_FAILED"))}})},wQk=function(J,R){var N,C,X,u;
return g.Y(function(f){if(f.K==1)return N=g.nX(R.entityKey).entityId,C=g.DR(N,"videoDownloadContextEntity"),g.q(f,EP(J.K,C,"videoDownloadContextEntity"),2);X=f.J;return(u=X)!=null&&u.offlineModeType?f.return({offlineModeType:X.offlineModeType}):f.return(void 0)})},cH9=function(J,R,N){var C,X,u,f,H;
return g.Y(function(k){if(k.K==1){if(!R.frameworkUpdates||!g.z(R.frameworkUpdates,wR))return k.return();if(!(g.z(R.frameworkUpdates,wR).mutations&&g.z(R.frameworkUpdates,wR).mutations.length>0&&g.z(R.frameworkUpdates,wR).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return k.ZM(2);C=g.nX(g.z(R.frameworkUpdates,wR).mutations[0].entityKey).entityId;return g.q(k,c4(J.K,C),3)}if(k.K!=2){X=k.J;u=g.z(N.actionMetadata,NG);if(H=(f=u)==null?void 0:f.playlistId)X.playlistId=H;X.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Xk(J.KC)?g.q(k,ek(C,J.K,N,J.V,X),2):g.N3(J.KC)?g.q(k,hu(C,J.K,N,J.V),2):k.ZM(2)}return g.q(k,K5E(g.z(R.frameworkUpdates,wR)),0)})},Cd=function(J,R,N,C,X,u){return new R7(R?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",qe(J),N,C,X,u)},yHk=function(J,R,N){R=CHV(J.KC,N.cotn,R);
N=g.Mn(R);return g.bs2(R,N,J.KC)},G6d=function(J,R){var N,C,X,u,f,H,k,v,W,S,L;
return g.Y(function(I){if(I.K==1)return N=[],g.q(I,I0(J.K,{mode:"readonly",QK:!0},function(F){var a=[],n=R.offlineVideoStreams;if(n){n=g.K(n);for(var B=n.next();!B.done;B=n.next())a.push($2(F,B.value,"offlineVideoStreams"))}return g.r9.all(a)}),2);
if(C=I.J)for(X=g.K(C),u=X.next();!u.done;u=X.next())if(f=u.value,H=void 0,(H=f)==null?0:H.streamsProgress)for(k=f.streamsProgress,v=0;v<k.length;v++)W=k[v],S=JSON.parse(W.formatStreamBytes),L={itag:S.itag,lmt:S.lastModified,xtags:S.xtags},N.push(L);return I.return(N)})},tWa=function(J,R){this.K=J;
this.KC=R},x0U=function(J,R){var N,C,X,u,f,H,k,v,W,S,L,I;
return g.Y(function(F){switch(F.K){case 1:return N=qe(R),g.q(F,Me(J.K,"videoPlaybackPositionEntity"),2);case 2:C=F.J;if(C.length===0)return F.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N));g.Ef(F,3);return g.q(F,uQ.getInstance(),5);case 5:X=F.J;if(!X)throw Error("prefStorage is undefined");return g.q(F,X.get("psi"),6);case 6:return u=F.J,k=(H=(f=u)==null?void 0:f.Bp)!=null?H:"0",g.q(F,U0l(C,k),7);case 7:return v=F.J,W={isPaused:v.watchHistoryPaused,Bp:v.syncTimestampUsec},g.q(F,X.set("psi",
W),8);case 8:if(W.isPaused){F.ZM(9);break}S=g.z(v.frameworkUpdates,wR);if(!v.frameworkUpdates||!S){F.ZM(9);break}return g.q(F,K5E(S),9);case 9:g.MP(F,4);break;case 3:return L=g.K2(F),I="PPE handleRefresh error: "+(L instanceof Error?L.message:"unknown error"),DY(I),F.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return F.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
N))}})},oqL=function(J,R){var N,C,X,u,f,H,k,v;
return g.Y(function(W){switch(W.K){case 1:return N=qe(R),C=g.nX(R.entityKey).entityId,g.Ef(W,2),g.q(W,uQ.getInstance(),4);case 4:X=W.J;if(!X)throw Error("prefStorage is undefined");return g.q(W,X.get("psi"),5);case 5:u=W.J;f=g.z(R.actionMetadata,JcJ);if(((H=u)==null?void 0:H.isPaused)!==!1||(k=f)==null||!k.lastPlaybackPositionSeconds){W.ZM(6);break}v={key:g.DR(C,"videoPlaybackPositionEntity"),videoId:C,lastPlaybackPositionSeconds:f.lastPlaybackPositionSeconds};return g.q(W,F4(J.K,v,"videoPlaybackPositionEntity"),
6);case 6:g.MP(W,3);break;case 2:return g.K2(W),W.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return W.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N))}})},Ry_=function(J,R){var N,C,X;
return g.Y(function(u){switch(u.K){case 1:N=qe(R);g.Ef(u,2);C=g.nX(R.entityKey).entityId;if(C==="!*$_ALL_ENTITIES_!*$")return g.q(u,L5q(J.K),5);X=g.DR(C,"videoPlaybackPositionEntity");return g.q(u,Sp9(J.K,X),5);case 5:g.MP(u,3);break;case 2:return g.K2(u),u.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return u.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
N))}})},Np9=function(J,R){this.api=J;
this.K=R;this.logger=new g.Pi("woffle");this.J=!1;this.QR={PF:this.PF};this.logger.debug("Initialized OfflineMediaManager")},CLK=function(J){return g.Y(function(R){return R.return(O$K(J))})},XRq=function(J){var R;
return g.Y(function(N){if(N.K==1)return g.q(N,g.aPk(J),2);R=N.J;return N.return(R.filter(function(C){return!!C.url}).map(function(C){return C.url}))})},XF=function(J,R){var N=g.gQ(R);
if(N===1||N===0)return Promise.resolve();(N=i4E(J,R))&&N.stopVideo();J.V=0;return CLK(R)},il=function(J,R,N,C){N=N===void 0?!1:N;
C=C===void 0?!0:C;var X=typeof R==="string"?R:R.videoDetails.videoId;g.gQ(X)===2&&((R=i4E(J,X))?R.stopVideo():J.logger.info(function(){return"Corresponding player for "+X+" not found. Pausing anyway"}),g.UA(X,2),J.V=2,N?ui9(J.K):C&&fxV(J.K))},i4E=function(J,R){var N;
return((N=J.player)==null?void 0:N.getVideoData().videoId)===R?J.player:null},TpJ=function(J,R,N){R.getPlayerResponse();
g.UA(R.videoId,2);J.V=2;J.J=!1;var C;(C=J.player)==null||C.dispose();J.player=J.api.So(9,R);R={};g.QP(J.player,(R.localmediachange=J.ea,R.signatureexpired=J.BZ,R.statechange=J.yE8,R),J);var X=J.PF(N);g.lJE(J.player,g.FT(X,X,!0,"m"),!1);J.logger.debug(function(){return"Starting headless playback with quality: "+X});
g.Nt(J.player,!1)},$Ol=function(J,R){this.K=J;
this.KC=R},kOK=function(J,R){var N,C;
return g.Y(function(X){switch(X.K){case 1:return N=qe(R),g.q(X,EP(J.K,R.entityKey,"transfer"),2);case 2:if(C=X.J)return X.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N));g.Ef(X,3);return g.q(X,H48(J,R),5);case 5:g.MP(X,4);break;case 3:return g.K2(X),X.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return X.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
N))}})},vq8=function(J,R){var N,C;
return g.Y(function(X){switch(X.K){case 1:return N=qe(R),g.q(X,EP(J.K,R.entityKey,"transfer"),2);case 2:C=X.J;if(!C||C.transferState!=="TRANSFER_STATE_COMPLETE")return X.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N));g.Ef(X,3);return g.q(X,H48(J,R,!0),5);case 5:g.MP(X,4);break;case 3:return g.K2(X),X.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return X.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N))}})},Whl=function(J,R){var N,C,X,u,f,H,k,v,W,S;
return g.Y(function(L){switch(L.K){case 1:return N=qe(R),C=g.nX(R.entityKey).entityId,g.q(L,I0(J.K,{mode:"readonly",QK:!0},function(I){var F=$2(I,R.entityKey,"transfer");I=$2(I,g.DR(C,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.r9.all([F,I])}),2);
case 2:X=L.J;u=g.K(X);f=u.next().value;H=u.next().value;k=f;v=H;if(!k||k.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return L.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N));g.Ef(L,3);k.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.q(L,F4(J.K,k,"transfer"),5);case 5:W=g.nX(k.key).entityId;dR({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:W,wU:k,offlineModeType:(S=v)==null?void 0:S.offlineModeType});g.MP(L,
4);break;case 3:return g.K2(L),L.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return L.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N))}})},H48=function(J,R,N){N=N===void 0?!1:N;
var C,X,u,f,H,k,v,W,S,L,I,F,a,n,B;return g.Y(function(Z){switch(Z.K){case 1:return C=g.z(R.actionMetadata,SEa),X=g.nX(R.entityKey).entityId,u=g.DR(X,"downloadStatusEntity"),g.q(Z,I0(J.K,{mode:"readonly",QK:!0},function(A){var V=$2(A,u,"downloadStatusEntity");A=$2(A,g.DR(X,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.r9.all([V,A])}),2);
case 2:return f=Z.J,H=g.K(f),k=H.next().value,v=H.next().value,W=k,S=v,L="TRANSFER_STATE_TRANSFER_IN_QUEUE",((I=W)==null?void 0:I.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(L="TRANSFER_STATE_PAUSED_BY_USER"),n={key:R.entityKey,transferState:L,cotn:g.jg(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(F=C)==null?void 0:F.maximumDownloadQuality,preferredAudioTrack:(a=C)==null?void 0:a.preferredAudioTrack,transferRetryCount:0,isRefresh:N,hasLoggedFirstStarted:!1},g.q(Z,I0(J.K,
{mode:"readwrite",QK:!0},function(A){var V=[];N&&V.push(W4(A,g.DR(X,"offlineVideoStreams")));V.push(v4(A,n,"transfer"));return g.r9.all(V)}),3);
case 3:if(!N){Z.ZM(4);break}return g.q(Z,CLK(X),4);case 4:dR({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:X,wU:n,offlineModeType:(B=S)==null?void 0:B.offlineModeType}),g.IQ(Z)}})},Ixd=function(J,R,N,C){if(!J.action.entityKey)throw Error("entityKey is missing.");
var X=g.nX(J.action.entityKey);X={entityType:X.KB,entityId:X.entityId,offlineOrchestrationActionType:J.action.actionType,orchestrationAction:{orchestrationActionId:J.actionId}};R&&(X.offlineOrchestrationActionResult=R.status,X.isRetryable=N?!1:R.K,R.V&&(X.offlineOrchestrationFailureReason=Lh8(R.V,X.isRetryable)));var u,f;if((u=J.action.actionMetadata)==null?0:(f=u.offlineLoggingData)==null?0:f.offlineModeType)X.offlineModeType=J.action.actionMetadata.offlineLoggingData.offlineModeType;C&&(X.additionalOrchestrationActions=
C.map(function(H){return{orchestrationActionId:H.actionId}}));
return X},Lh8=function(J,R){return J!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||R?J==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&R?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":J:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},FhK=function(J,R){var N={offlineOrchestrationContext:Ixd(J)};
R=jo_(R,N);mha(rXU(),R,J.rootActionId)},EqV=function(J,R,N,C){C=C===void 0?[]:C;
R={offlineOrchestrationContext:Ixd(J,R,N,C)};R=jo_(3,R);mha(rXU(),R,J.rootActionId)},MQa=function(){this.actions=[]},Khd=function(J,R){R=g.K(R);
for(var N=R.next();!N.done;N=R.next())N=N.value,FhK(N,1),J.actions.push(N);J.actions.sort(J.K)},ax9=function(J,R){if(R)for(var N=0;N<J.actions.length;N++)if(R==="!*$_ALL_ENTITIES_!*$"&&J.actions[N].actionId!==R||R!=="!*$_ALL_ENTITIES_!*$"&&J.actions[N].rootActionId===R&&J.actions[N].actionId!==R)J.actions.splice(N,1),N--},QSP=function(J,R){J=g.K(J.actions);
for(var N=J.next();!N.done;N=J.next())if(N.value.actionId===R)return!0;return!1},ul=function(J,R,N,C,X){g.l.call(this);
var u=this;this.J=J;this.ma=R;this.nC=N;this.D=C;this.KC=X;this.K=new MQa;this.S=new g.HG;this.V=new g.$t(function(){u.retry()});
this.X=NaN;this.U=!1;this.QR={E0k:function(){return u.K},
sX:function(){return u.S},
KEk:function(){return u.V},
retry:function(){return u.retry()}};
g.P(this,this.V);this.W=this.J.observe(this.dn.bind(this))},sSa=function(J,R,N,C,X){var u;
return g.Y(function(f){if(f.K==1)return u=new ul(J,R,N,C,X),g.q(f,nqf(u),2);DOK(u);return f.return(u)})},DOK=function(J){var R=J.K.actions[0];
return J.Z?((R==null?void 0:R.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&J.Z[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(J.U=!0),Promise.resolve()):Bp8(J)},Bp8=function(J){var R,N,C,X,u,f,H,k,v,W,S,L,I,F,a,n,B;
return g.Y(function(Z){switch(Z.K){case 1:if(J.Z)throw Error("Already processing an action");if(J.QO())return Z.return();R=J.K.actions.shift();G9a(J.nC,!R);if(R===void 0)return Z.return();R.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&R.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&ax9(J.K,R.actionId);N="";R.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&R.rootActionId===R.actionId&&(N=R.actionId);C=[R];J.Z=C;if(X=J.ma[R.entityType]){Z.ZM(2);break}J.Z=
void 0;return g.q(Z,Bp8(J),3);case 3:return Z.return();case 2:u=g.K(C);for(f=u.next();!f.done;f=u.next())H=f.value,FhK(H,2);g.Ef(Z,4,5);return g.q(Z,zp_(X,C.map(function(A){return A.action})),7);
case 7:k=Z.J,v=g.K(C),W=v.next();case 8:if(W.done){Z.ZM(10);break}S=W.value;L=k.get(S.action);return g.q(Z,O4U(J,S,L),9);case 9:W=v.next();Z.ZM(8);break;case 10:ax9(J.K,N);case 5:g.aQ(Z);J.Z=void 0;g.QE(Z,6);break;case 4:return I=g.K2(Z),DY("Orchestration error",I),g.Ef(Z,12),g.q(Z,Z4P(J,C),14);case 14:g.MP(Z,5);break;case 12:F=g.K2(Z);DY("Orchestration retry error",F);a=g.K(C);for(n=a.next();!n.done;n=a.next())B=n.value,B.retryScheduleIndex<3&&Khd(J.K,[B]);Z.ZM(5);break;case 6:return g.q(Z,Bp8(J),
0)}})},O4U=function(J,R,N){var C,X,u,f,H,k,v,W,S,L,I,F;
return g.Y(function(a){switch(a.K){case 1:C=R.retryScheduleIndex+2===3;if(N.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){a.ZM(2);break}if(N.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){a.ZM(0);break}EqV(R,N,C);if(N.K&&R.retryScheduleIndex+1<3)return g.q(a,Z4P(J,[R]),0);u=((X=N)==null?0:X.J)?N.J:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";f={entityKey:R.action.entityKey,failureReason:u};H=void 0;g.Xk(J.KC)?H="mainVideoDownloadStateEntity":g.N3(J.KC)&&(H="musicTrackDownloadMetadataEntity");
if(!H||!N.downloadState){a.ZM(7);break}k=g.nX(R.action.entityKey).entityId;return g.q(a,jk(k,H,J.J,N.downloadState),7);case 7:B4(J.D,f);if(N.downloadState==="DOWNLOAD_STATE_FAILED"&&J.KC.T("html5_auto_retry_failed_pde_actions")){a.ZM(0);break}DY("Orchestration result is not retryable, deleting action");return g.q(a,Sp9(J.J,lQ(R).key),0);case 2:v=void 0;try{v=(W=N.Z)==null?void 0:W.map(function(n){return J.createAction(n,R)})}catch(n){return EqV(R,N,C),S={entityKey:R.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},B4(J.D,S),DY("Orchestration subactions creation error",n),a.return()}EqV(R,N,C,v);if(!v){a.ZM(12);break}L=v.map(function(n){return lQ(n)});
I=0;case 13:if(!(I<v.length)||J.U){a.ZM(15);break}return g.q(a,I0(J.J,{mode:"readwrite",QK:!0},function(n){var B=[];B.push(XKd(n,L.slice(I,I+10),"offlineOrchestrationActionWrapperEntity"));return g.r9.all(B)}),16);
case 16:I+=10;a.ZM(13);break;case 15:if(J.U)return J.U=!1,a.return();case 12:return F=lQ(R),g.q(a,Sp9(J.J,F.key),17);case 17:FhK(R,4),g.IQ(a)}})},YE9=function(J,R){var N,C,X,u,f,H,k,v,W,S,L,I;
return g.Y(function(F){N=[];C=Infinity;X=4E3;u=g.K(R);for(f=u.next();!f.done;f=u.next())H=f.value,k=Number(H.enqueueTimeSec),v=dO9(k),W=H.retryScheduleIndex,S=W!=null&&W>0,v>0&&S?(C=Math.min(C,k),X=Math.min(v,X)):N.push(H);isFinite(C)&&(!J.V.isActive()||C<J.X)&&(J.X=C,J.V.start(X));J.S.Tj()||(L=N.length,N=N.filter(function(a){var n;a=((n=a.actionProto)==null?void 0:n.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!qEP.includes(a)}),I=N.length<L,!J.V.isActive()&&I&&J.V.start(1));
N.length>0&&Acl(J,N);return g.q(F,DOK(J),0)})},jSl=function(J){var R,N,C,X,u,f,H;
return g.Y(function(k){if(k.K==1)return g.q(k,rcd(J),2);R=k.J;N=[];C=g.K(R);for(X=C.next();!X.done;X=C.next())u=X.value,f=g.nX(u.key),H=f.entityId,QSP(J.K,H)||N.push(u);return g.q(k,YE9(J,N),0)})},dO9=function(J){J=J*1E3-Date.now();
return J>4E3?4E3:J},Z4P=function(J,R){var N,C,X;
return g.Y(function(u){N=g.K(R);for(C=N.next();!C.done;C=N.next()){X=C.value;var f=void 0,H=void 0,k=((H=X.action)==null?void 0:(f=H.actionMetadata)==null?void 0:f.retryScheduleIntervalsInSeconds)||[1,2,4];f=1;X.retryScheduleIndex<k.length&&(f=k[X.retryScheduleIndex]);X.K=f*1E3+Date.now();X.retryScheduleIndex++}return g.q(u,mO8(J,R),0)})},nqf=function(J){var R;
return g.Y(function(N){if(N.K==1)return g.q(N,Me(J.J,"offlineOrchestrationActionWrapperEntity"),2);R=N.J;return g.q(N,YE9(J,R),0)})},Acl=function(J,R){R.length!==0&&R.forEach(function(N){N=px(N);
N.retryScheduleIndex<3&&Khd(J.K,[N])})},rcd=function(J,R){var N;
return g.Y(function(C){if(C.K==1)return g.q(C,Me(J.J,"offlineOrchestrationActionWrapperEntity",R),2);N=C.J;return C.return(N.filter(a$K))})},mO8=function(J,R){if(R.length===0)return Promise.resolve([]);
R=R.map(function(N){return lQ(N)});
return W5L(J.J,R)},VQl=function(J){this.x8=J;
this.K=void 0},UO_=function(J,R){var N,C,X,u;
return g.Y(function(f){N=R.videoId;C=!0;if(R.captionTracks.length)X=uwf(R),J.K=new g.FA(J.x8,R,X);else if(R.pL)u=g.o6f(R),J.K=new g.Eg(J.x8,R.pL,N,u,R.tD,R.eventId),C=R.tD;else return f.return();return f.return(new Promise(function(H){var k;(k=J.K)==null||k.Nw(function(){return g.Y(function(v){if(v.K==1)return g.q(v,gql(J,N,C),2);H();g.IQ(v)})})}))})},gql=function(J,R,N){N=N===void 0?!0:N;
var C,X,u,f,H,k,v,W;return g.Y(function(S){switch(S.K){case 1:if(!J.K)return S.return();C=[];X=g.NT(J.K.K,N);u=[];for(f={Ug:0};f.Ug<X.length;f={Ug:f.Ug},f.Ug++)H=X[f.Ug],k=J.K.M1(H,"json3"),v=g.lL(k,{withCredentials:!0,format:"RAW"},3,500).then(function(L){return function(I){I={metadata:g.nW(X[L.Ug]),trackData:I.xhr.responseText};u.push(I)}}(f)).vY(function(L){DY("Caption fetch error",L)}),C.push(v);
return g.q(S,fyE(C),2);case 2:return g.Ef(S,3),g.q(S,soJ(R,u),5);case 5:g.MP(S,0);break;case 3:W=g.K2(S),DY("Caption DB transaction error",W),g.IQ(S)}})},pR8=function(J){var R;
return g.Y(function(N){if(N.K==1)return g.q(N,BEJ(J),2);R=N.J;return N.return(!!R&&R.length>0)})},fd=function(J){g.l.call(this);
this.K=J;this.J=this.K.observe(this.V.bind(this))},lx9=function(J,R){var N,C,X,u,f,H,k;
return g.Y(function(v){switch(v.K){case 1:if(R.length===0)return v.return([]);N=R.map(function(W){return g.DR(W,"transfer")});
return g.q(v,Me(J.K,"transfer",N),2);case 2:C=v.J;X=C.filter(a$K).map(function(W){return g.nX(W.key).entityId});
u=R.filter(function(W){return X.indexOf(W)===-1});
if(u.length===0)return v.return([]);f=g.K(u);H=f.next();case 3:if(H.done){v.ZM(5);break}k=H.value;return g.q(v,CLK(k),4);case 4:H=f.next();v.ZM(3);break;case 5:return v.return(u)}})},ey9=function(J,R,N,C,X,u){var f,H,k;
return g.Y(function(v){f="STREAM_TYPE_UNKNOWN";N.video&&N.audio?(f="STREAM_TYPE_AUDIO_AND_VIDEO",DY("unexpected stream type")):N.video&&!N.audio?f="STREAM_TYPE_VIDEO":!N.video&&N.audio&&(f="STREAM_TYPE_AUDIO");H=g.DR(R,"offlineVideoStreams");k={numBytesDownloaded:X.toFixed(),numTotalBytes:u.toFixed(),streamType:f,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(C),itag:f==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(N.itag):void 0};return g.q(v,I0(J,{mode:"readwrite",QK:!0},
function(W){var S=$2(W,H,"offlineVideoStreams"),L=$2(W,g.DR(R,"transfer"),"transfer");return g.r9.all([S,L]).then(function(I){I=g.K(I);var F=I.next().value;I=I.next().value;if(!I)return W4(W,H).then(function(){});
var a=PLk(F);F=zyL(F,C,k,H);var n=v4(W,F,"offlineVideoStreams");PLk(F)>a&&(I.lastProgressTimeMs=Date.now().toString());a=[n];I.offlineVideoStreams||(I.offlineVideoStreams=[]);I.offlineVideoStreams.indexOf(H)===-1&&(I.offlineVideoStreams.push(H),a.push(v4(W,I,"transfer")));return g.r9.all(a)})}),0)})},wRf=function(J,R){var N,C,X,u,f;
return g.Y(function(H){if(H.K==1)return N=g.DR(R,"offlineVideoStreams"),g.q(H,EP(J,N,"offlineVideoStreams"),2);C=H.J;if(!C||!C.streamsProgress)return H.return();X=g.K(C.streamsProgress);for(u=X.next();!u.done;u=X.next())f=u.value,f.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",f.numTotalBytes!==f.numBytesDownloaded&&(f.numBytesDownloaded=f.numTotalBytes);return g.q(H,F4(J,C,"offlineVideoStreams"),0)})},zyL=function(J,R,N,C){if(J&&J.streamsProgress){C=J;
a:{R=R.itag+";"+R.xtags;for(var X=J.streamsProgress,u=0;u<X.length;u++){var f=JSON.parse(X[u].formatStreamBytes);if(f.itag+";"+f.xtags===R){X[u]=N;N=X;break a}}X.push(N);N=X}C.streamsProgress=N}else J={key:C,streamsProgress:[N]};return J},PLk=function(J){if(J==null?0:J.streamsProgress){var R=0;
J=J.streamsProgress;for(var N=0;N<J.length;N++){var C=J[N];isNaN(Number(C.numBytesDownloaded))?DY("stream progress bytes number invalid"):R+=Number(C.numBytesDownloaded)}return R}return 0},ccl=function(J,R,N,C){g.l.call(this);
var X=this;this.J=J;this.api=R;this.l3=N;this.dn=C;this.S=new g.HG;this.Z=new g.$t(function(){X.K&&X.K.transferState==="TRANSFER_STATE_TRANSFERRING"&&X.S.Tj()&&((X.K.transferRetryCount||0)<3?il(X.D,X.U,!1,!1):XF(X.D,X.U.videoDetails.videoId),X.rJ("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.nC=this.VO=0;this.W=this.X=!1;this.pC=g.di(this.api.N().experiments,"html5_transfer_processing_logs_interval");this.T7=new g.tY(this);this.QR={vDM:function(){return X.Z},
bmk:function(){return X.dn},
sX:function(){return X.S}};
this.ma=this.J.observe(this.nQ.bind(this));this.D=new Np9(R,this);this.HC=new VQl(R);this.tN=new fd(this.J);this.G7=this.S.listen("publicytnetworkstatus-online",this.rf.bind(this));this.PC=this.S.listen("publicytnetworkstatus-offline",this.sGN.bind(this));this.W=this.api.N().T("html5_less_transfer_processing_logs");g.P(this,this.T7);this.T7.L(R,"offlinetransferpause",this.jGC);g.Xk(this.api.N())?this.V="mainVideoDownloadStateEntity":g.N3(this.api.N())&&(this.V="musicTrackDownloadMetadataEntity")},
hy_=function(J){return g.Y(function(R){if(R.K==1)R=g.q(R,DhP(),2);
else{var N=J.tN;var C=g.Vz();C=Object.keys(C);N=lx9(N,C);R=g.q(R,N,0)}return R})},$D=function(J,R){R=R===void 0?!1:R;
var N;return g.Y(function(C){if(C.K==1){if(J.K)throw Error("Already downloading a video");J.nC=0;J.X=!1;return g.q(C,ycd(J),2)}return C.K!=4?(N=C.J,b$U(J.l3,!N),N&&J.S.Tj()?R?g.q(C,new Promise(function(X){g.BR(X,1E3)}),4):C.ZM(4):(!N&&J.K&&Tq(J),C.ZM(0))):g.q(C,GOJ(J,N),0)})},b48=function(J){return g.Y(function(R){if(R.K==1)return J.U?g.q(R,XF(J.D,J.U.videoDetails.videoId),3):R.ZM(0);
Tq(J);g.IQ(R)})},tQ_=function(J,R){var N,C,X;
return g.Y(function(u){switch(u.K){case 1:return g.Ef(u,2),(N=!!R.captionTracks.length||!!R.pL)?g.q(u,pR8(R.videoId),4):u.return();case 4:return(C=u.J)?u.return():g.q(u,UO_(J.HC,R),5);case 5:g.MP(u,0);break;case 2:X=g.K2(u),DY("Caption downloading error",X,R.cotn),g.IQ(u)}})},GOJ=function(J,R){var N,C,X,u,f,H;
return g.Y(function(k){switch(k.K){case 1:if(J.X)return k.return();J.X=!0;J.K=R;N=g.nX(J.K.key);C=N.entityId;X=void 0;if(J.K.transferState==="TRANSFER_STATE_TRANSFERRING")return g.q(k,HL(J,C),7);if(J.K.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||J.K.transferRetryCount||J.K.hasLoggedFirstStarted){k.ZM(3);break}return g.q(k,HL(J,C),5);case 5:return X=k.J,J.K.hasLoggedFirstStarted=!0,g.q(k,xO_(J),6);case 6:t_V({videoId:C,wU:J.K,offlineModeType:X},void 0,void 0,!0);k.ZM(3);break;case 7:X=k.J,
dR({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:C,wU:J.K,offlineModeType:X});case 3:return g.q(k,JfJ(J),8);case 8:return u=null,g.Ef(k,9),g.q(k,oIP(J,R),11);case 11:u=k.J;J.U=u;g.MP(k,10);break;case 9:return f=g.K2(k),DY("error getting player response",f,R.cotn),g.q(k,J.rJ("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return k.return();case 10:return H=CHV(J.api.N(),R.cotn,u),g.q(k,tQ_(J,H),13);case 13:return g.q(k,XRq(H.videoId),
14);case 14:H.mw=k.J,TpJ(J.D,H,R.maximumDownloadQuality),J.Z.start(108E5),g.IQ(k)}})},ycd=function(J){var R,N;
return g.Y(function(C){if(C.K==1)return g.q(C,Me(J.J,"transfer"),2);R=C.J;N=R.filter(Rm9).sort(NJ_);return N.length===0?C.return():C.return(N[0])})},JfJ=function(J){var R,N,C;
return g.Y(function(X){if(X.K==1){if(!J.K)return kD(J,"onTransferStart"),X.return();J.Z.start(108E5);return g.q(X,vL(J,"TRANSFER_STATE_TRANSFERRING"),2)}R=J.K;return(C=((N=R)==null?0:N.key)?g.nX(R.key).entityId:"")&&J.V?g.q(X,jk(C,J.V,J.J,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):X.ZM(0)})},ui9=function(J){var R,N,C,X;
g.Y(function(u){switch(u.K){case 1:if(!J.K){kD(J,"onTransferPausedByUser");u.ZM(2);break}R=J.K;J.Z.stop();return g.q(u,vL(J,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:C=((N=R)==null?0:N.key)?g.nX(R.key).entityId:"";if(!C||!J.V){u.ZM(4);break}return g.q(u,jk(C,J.V,J.J,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.q(u,HL(J,C),6);case 6:X=u.J,xhJ({videoId:C,wU:R,offlineModeType:X});case 2:Tq(J),$D(J),g.IQ(u)}})},fxV=function(J){var R,N,C;
g.Y(function(X){if(X.K==1){if(!J.K)return kD(J,"onTransferPausedByNetwork"),X.return();J.Z.stop();return g.q(X,vL(J,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(X.K!=3)return R=J.K,(C=((N=R)==null?0:N.key)?g.nX(R.key).entityId:"")&&J.V?g.q(X,jk(C,J.V,J.J,"DOWNLOAD_STATE_PAUSED"),3):X.ZM(3);Tq(J);g.IQ(X)})},C4a=function(J){var R,N,C,X,u;
g.Y(function(f){switch(f.K){case 1:if(!J.K)return kD(J,"onTransferComplete"),f.return();R=J.K;J.Z.stop();if(!R||!J.U){f.ZM(2);break}N=CHV(J.api.N(),R.cotn,J.U);return g.q(f,tQ_(J,N),2);case 2:return g.q(f,vL(J,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:X=((C=R)==null?0:C.key)?g.nX(R.key).entityId:"";if(!X||!J.V){f.ZM(5);break}return g.q(f,jk(X,J.V,J.J,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.q(f,wRf(J.J,X),7);case 7:return g.q(f,HL(J,X),8);case 8:u=f.J,dR({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:X,wU:R,offlineModeType:u}),Tq(J),$D(J),g.IQ(f)}})},X1K=function(J,R,N){var C,X;
g.Y(function(u){switch(u.K){case 1:if(!J.K)return kD(J,"onTransferProgress: "+R),u.return();if(J.K.transferState==="TRANSFER_STATE_TRANSFERRING"){u.ZM(2);break}return g.q(u,JfJ(J),2);case 2:C=Date.now();if(!(C-J.VO>1E3)){u.ZM(4);break}J.VO=C;return g.q(u,ey9(J.J,N.videoId,N.J,N.cF,N.bytesDownloaded,N.K),5);case 5:if(J.W&&!(J.W&&C-J.nC>J.pC)){u.ZM(4);break}J.nC=C;return g.q(u,HL(J,R),7);case 7:X=u.J,t_V({videoId:R,wU:J.K,offlineModeType:X},N.bytesDownloaded,N.K);case 4:J.Z.start(108E5),g.IQ(u)}})},
iI8=function(J){var R=(J.K.transferRetryCount||0)<3;
R&&(J=J.K,J.transferRetryCount=(J.transferRetryCount||0)+1);return R},u6q=function(J,R){R=R===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":R;
var N,C,X,u;return g.Y(function(f){if(f.K==1)return J.K||kD(J,"setTransferToFailed: "+R),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",R==="TRANSFER_FAILURE_REASON_NETWORK"?N="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":R==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.q(f,vL(J,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",R),2);if(f.K!=3)return B4(J.dn,{entityKey:(C=J.K)==null?void 0:C.key,failureReason:N}),
X=J.K?g.nX(J.K.key).entityId:"",g.q(f,HL(J,X),3);u=f.J;var H={videoId:X,wU:J.K,offlineModeType:u},k=R,v={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};k&&(v.transferFailureReason=k,v.failureReason=JHk(k));dR(v,H);g.IQ(f)})},vL=function(J,R,N,C){var X;
return g.Y(function(u){if(u.K==1){if(!J.K)return kD(J,"saveTransferState: "+R),u.return();J.K.transferState=R;J.K.failureReason=C;g.Ef(u,2);return g.q(u,xO_(J,function(f){return N?H4(f,"offlineVideoStreams",J.K.offlineVideoStreams).then(function(H){for(var k=g.K(H),v=k.next();!v.done;v=k.next())if((v=v.value)&&v.streamsProgress){v=g.K(v.streamsProgress);for(var W=v.next();!W.done;W=v.next())W.value.streamState=N}return XKd(f,H.filter(function(S){return!!S}),"offlineVideoStreams")}):g.r9.resolve(void 0)}),
4)}if(u.K!=2)return g.MP(u,0);
X=g.K2(u);return X instanceof g.B9&&X.type==="QUOTA_EXCEEDED"?g.q(u,J.rJ("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):u.ZM(0)})},xO_=function(J,R){var N;
return g.Y(function(C){if(!J.K)return C.return();N=J.K;return g.q(C,I0(J.J,{mode:"readwrite",QK:!0},function(X){var u=[v4(X,N,"transfer")];R&&u.push(R(X));return g.r9.all(u)}),0)})},Tq=function(J){J.K=void 0;
J.U=void 0;J.Z.stop()},oIP=function(J,R){var N,C,X,u,f;
return g.Y(function(H){if(H.K==1)return N=g.nX(R.key),C=N.entityId,X=g.DR(C,"playbackData"),g.q(H,EP(J.J,X,"playbackData"),2);u=H.J;if((f=u)==null?0:f.playerResponseJson)return H.return(JSON.parse(u.playerResponseJson));throw Error("No PlayerResponse found");})},kD=function(J,R){J.api.u3("woffle",{mcte:R});
DY("missing current transfer entity.")},HL=function(J,R){var N,C,X;
return g.Y(function(u){if(u.K==1)return g.q(u,EP(J.J,g.DR(R,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);N=u.J;return u.return((X=(C=N)==null?void 0:C.offlineModeType)!=null?X:void 0)})},Rm9=function(J){return feJ[J.transferState]!==void 0},NJ_=function(J,R){var N=feJ[J.transferState],C=feJ[R.transferState];
return N!==C?N-C:Number(J.enqueuedTimestampMs)-Number(R.enqueuedTimestampMs)},WL=function(J,R){var N=this;
this.KC=J;this.api=R;this.S=new g.HG;this.U=new g.Qt;this.QR={bD:function(){return N.V.QR.bD()},
sX:function(){return N.S},
zxa:function(){return N.V},
pU:function(){return N.pU()},
EY:function(){return N.EY()},
w9:function(){return N.w9()},
OY:function(){return N.OY()},
cM:function(){return N.cM()},
uX:function(C){return N.uX(C)}};
this.V=new cXU(function(){return TJJ(N)},function(){N.w9()},this.api.nJ(),this.api.T.bind(this.api));
this.K=new sP(this.api);hwa(this.V)},TJJ=function(J){return g.Y(function(R){J.api.z7("onOrchestrationBecameLeader");
return g.q(R,J.EY(),0)})},HIq=function(J){var R,N;
return g.Y(function(C){if(C.K==1)return g.q(C,Kx(),2);if(C.K!=3){R=C.J;if(!R)return DY("PES is undefined"),C.return();J.J=new ccl(R,J.api,J.V,J.K);N=J.I_(R);return g.q(C,sSa(R,N,J.V,J.K,J.KC),3)}J.D=C.J;return g.q(C,$Y9(J),0)})},$Y9=function(J){var R;
return g.Y(function(N){switch(N.K){case 1:if(!J.J)return DY("transferManager is undefined"),N.return();if(J.J.K){N.ZM(2);break}return g.q(N,$D(J.J),2);case 2:if(!J.KC.T("woffle_enable_main_downloads_library")){N.ZM(4);break}return g.q(N,J.nu(),4);case 4:if(!J.KC.T("html5_offline_playback_position_sync")){N.ZM(6);break}return g.q(N,J.U8(),7);case 7:return g.q(N,J.uX(864E5),6);case 6:return g.q(N,J.refreshAllStaleEntities(43200,!0),9);case 9:return g.q(N,J.qm(),10);case 10:if(!J.KC.T("html5_retry_downloads_for_expiration")){N.ZM(11);
break}return g.q(N,J.cM(),11);case 11:return J.X=g.OE(function(){J.refreshAllStaleEntities(43200,!0);J.qm()},9E5),g.TB(g.H9(),function(){return J.OY()}),g.q(N,Kx(),13);
case 13:return R=N.J,g.q(N,wK9(R),14);case 14:yXf(J.V),g.IQ(N)}})},km9=function(){var J,R,N,C,X,u;
return g.Y(function(f){switch(f.K){case 1:return g.q(f,Kx(),2);case 2:J=f.J;if(!J)return f.return([]);R=Date.now()/1E3;return g.q(f,Me(J,"offlineVideoPolicy"),3);case 3:N=f.J,C=g.K(N),X=C.next();case 4:if(X.done){f.ZM(6);break}u=X.value;if(!(u.expirationTimestamp&&Number(u.expirationTimestamp)<R)){f.ZM(5);break}u.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";u.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.q(f,F4(J,u,"offlineVideoPolicy"),5);
case 5:X=C.next();f.ZM(4);break;case 6:return f.return(N.map(function(H){return H.key}))}})},SX=function(J,R,N,C,X){var u,f,H;
return g.Y(function(k){if(k.K==1)return g.q(k,Kx(),2);u=k.J;if(!u)return k.return([]);f=R.map(function(v){var W=g.DR(v,N);W={actionType:C,entityKey:W,actionMetadata:Object.assign({},XQP(),X)};C!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(W.actionMetadata.priority=0);v=new UP(N,v,W);return lQ(v)});
H=W5L(u,f);hwa(J.V);return k.return(H)})},vIJ=function(J,R,N,C){var X,u,f,H,k,v,W,S;
return g.Y(function(L){switch(L.K){case 1:X=[],u=g.K(R),f=u.next();case 2:if(f.done){L.ZM(4);break}H=f.value;if(H.upToDate||N&&!H.shouldAutoSyncMetadata||!H.playlistId){L.ZM(3);break}k={};switch(C){case "mainPlaylistEntity":v={nextAutoRefreshIntervalSeconds:H.checkInSeconds,autoSync:N};k={mainPlaylistEntityActionMetadata:v};break;case "musicPlaylist":W={autoSync:N},k={musicPlaylistEntityActionMetadata:W}}return g.q(L,SX(J,[H.playlistId],C,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",k),6);case 6:(S=
L.J)&&X.push.apply(X,g.Q(S));case 3:f=u.next();L.ZM(2);break;case 4:return L.return(X)}})},Wjl=function(J,R){var N;
return g.Y(function(C){return R.length?(N=XQP(),g.ol(N,NG,{isEnqueuedForExpiredStreamUrlRefetch:!0}),J.api.u3("qrd",{v:R.length}),C.return(SX(J,R,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N))):C.return([])})},S79=function(J,R,N){this.K=J;
this.KC=R;this.V=N},Fj9=function(J,R){var N,C,X,u,f,H,k,v,W,S,L,I,F,a,n,B,Z;
return g.Y(function(A){switch(A.K){case 1:return N=qe(R),C=g.nX(R.entityKey),X=C.entityId,u=[],g.Ef(A,2),g.q(A,LjE(J,X),4);case 4:u=A.J;if(!(J.KC.T("woffle_enable_main_downloads_library")&&((f=u)==null?0:f.length))){A.ZM(5);break}return g.q(A,F6V(J.K,[R.entityKey]),5);case 5:g.MP(A,3);break;case 2:return H=g.K2(A),k="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.B9&&H.type==="QUOTA_EXCEEDED"?(k="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):DY("Playlist add error"),A.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,k,v));case 3:W=[];if(!J.KC.T("html5_offline_prevent_redownload_downloaded_video")){A.ZM(7);break}return g.q(A,NlV(J.K,"mainVideoEntity",u),8);case 8:u=A.J;case 7:if((S=u)==null?0:S.length)for(L=g.K(u),I=L.next();!I.done;I=L.next())if(F=I.value,a=F.offlineVideoData,n=void 0,(n=a)==null?0:n.videoId)B=void 0,Z=Number(((B=R.actionMetadata)==null?void 0:B.priority)||
0)+1,W.push(o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a.videoId,"mainVideoEntity",Z,Ld,Iea(R,a,X)));return A.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N,W))}})},M0L=function(J,R){var N,C,X,u,f,H,k,v,W,S,L,I,F,a,n,B,Z,A,V,p,b,w,RQ,$E,G,e,t,E,y,b8,FV,Hl,Of,oU,SE,tk,D,O,d,r,U,Jk,i8,C2,m,Hg,FB,u8,jn,uP,p8,vb,cg,mS,vh,li,Ph,eF,Dr,zs,bu,wq,LK,gt,Vt,L6,Us,cO,gZ,uf,s2,X9,j4,G6;
return g.Y(function(Wb){switch(Wb.K){case 1:return N=qe(R),C=R.entityKey,X=g.nX(C).entityId,u=[],f=!1,X==="!*$_ALL_ENTITIES_!*$"?(f=!0,g.q(Wb,Me(J.K,"mainPlaylistEntity"),5)):g.q(Wb,EP(J.K,C,"mainPlaylistEntity"),4);case 4:(H=Wb.J)&&u.push(H);Wb.ZM(3);break;case 5:u=Wb.J;case 3:if((k=u)==null||!k.length)return Wb.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N));v=g.z(R.actionMetadata,EIa);S=(W=v)==null?void 0:W.nextAutoRefreshIntervalSeconds;I=(L=v)==null?void 0:L.autoSync;F=[];n=a=
!0;B=!1;if(!f&&I===!1){Wb.ZM(6);break}g.Ef(Wb,7);return g.q(Wb,AHq(0,!!I,!0,u),9);case 9:F=Wb.J;g.MP(Wb,8);break;case 7:Z=g.K2(Wb);if(!(Z instanceof Error&&Z.message==="No data")){Z instanceof Error&&Z.message==="Empty response body"&&DY(Z.message);Wb.ZM(8);break}return X==="!*$_ALL_ENTITIES_!*$"?g.q(Wb,k6a(J.K,R,J.V,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.q(Wb,$0J(X,J.K,R,J.V),8);case 8:if(!F.length||!f&&F[0].playlistId!==X)return Wb.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
N));case 6:if(f){A=[];V=g.K(F);for(p=V.next();!p.done;p=V.next())b=p.value,b.upToDate||I&&!b.shouldAutoSyncMetadata||!b.playlistId||(w={nextAutoRefreshIntervalSeconds:b.checkInSeconds,autoSync:I},A.push(o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",b.playlistId,"mainPlaylistEntity",0,Ld,{mainPlaylistEntityActionMetadata:w})));return Wb.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N,A))}F.length&&(RQ=F[0],B=!!RQ.upToDate,I&&(a=($E=RQ.shouldAutoSyncMetadata)!=null?$E:!0,n=(G=RQ.shouldAutoSyncVideos)!=
null?G:!0,RQ.checkInSeconds&&(S=RQ.checkInSeconds)));if(B||!a)return Wb.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N));e=[];t=u[0];if(!t.downloadState){E=void 0;Wb.ZM(15);break}return g.q(Wb,EP(J.K,t.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:E=Wb.J;case 15:return y=E,FV=((b8=y)==null?0:b8.addedTimestampMillis)?String(y.addedTimestampMillis):void 0,g.Ef(Wb,17),g.q(Wb,LjE(J,X,FV,S),19);case 19:e=Wb.J;g.MP(Wb,18);break;case 17:Hl=g.K2(Wb);if(!(Hl instanceof Error&&
Hl.message==="No data for playlist")){if(Hl instanceof Error&&Hl.message==="Empty response body for playlist")DY(Hl.message);else return Of="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",oU="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Hl instanceof g.B9&&Hl.type==="QUOTA_EXCEEDED"&&(Of="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",oU="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Wb.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,Of,oU));Wb.ZM(18);
break}return g.q(Wb,$0J(X,J.K,R,J.V),18);case 18:if(!n)return Wb.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N));SE=[];tk=new Map;if((D=e)==null?0:D.length)for(O=g.K(e),d=O.next();!d.done;d=O.next())r=d.value,U=r.offlineVideoData,Jk=void 0,((Jk=U)==null?0:Jk.videoId)&&tk.set(U.videoId,U);i8=new Map;C2=[];if((m=t)==null?0:(Hg=m.videos)==null?0:Hg.length)for(FB=g.K(t.videos),u8=FB.next();!u8.done;u8=FB.next())if(jn=u8.value,uP=JSON.parse(g.nX(jn).entityId),p8=uP.videoId)tk.has(p8)?(i8.set(p8,
tk.get(p8)),tk.delete(p8)):C2.push(p8);cg=Number(((vb=R.actionMetadata)==null?void 0:vb.priority)||0)+1;mS=g.K(tk.entries());for(vh=mS.next();!vh.done;vh=mS.next())li=vh.value,Ph=g.K(li),eF=Ph.next().value,Dr=Ph.next().value,zs=eF,bu=Dr,SE.push(o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",zs,"mainVideoEntity",cg,Ld,Iea(R,bu,X)));wq=g.K(i8.entries());for(LK=wq.next();!LK.done;LK=wq.next())gt=LK.value,Vt=g.K(gt),L6=Vt.next().value,Us=Vt.next().value,cO=L6,gZ=Us,SE.push(o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
cO,"mainVideoEntity",cg,Ld,Iea(R,gZ,X)));uf=g.K(C2);for(s2=uf.next();!s2.done;s2=uf.next())X9=s2.value,j4={playlistId:X},G6={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:j4},SE.push(o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",X9,"mainVideoEntity",0,Ld,G6));return Wb.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N,SE))}})},KjK=function(J,R){var N,C,X,u;
return g.Y(function(f){switch(f.K){case 1:return N=qe(R),g.Ef(f,2),C=g.nX(R.entityKey).entityId,C==="!*$_ALL_ENTITIES_!*$"?g.q(f,k6a(J.K,R,J.V,(X=R.actionMetadata)==null?void 0:(u=X.offlineLoggingData)==null?void 0:u.offlineDeleteReason),5):g.q(f,$0J(C,J.K,R,J.V),6);case 6:if(!J.KC.T("woffle_enable_main_downloads_library")){f.ZM(5);break}return g.q(f,EHV(J.K,R.entityKey),5);case 5:g.MP(f,3);break;case 2:return g.K2(f),f.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return f.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N))}})},LjE=function(J,R,N,C){var X,u,f,H,k,v,W;
return g.Y(function(S){switch(S.K){case 1:return g.q(S,d0J([R]),2);case 2:return X=S.J,g.q(S,aeV(J,X[0],N,C),3);case 3:return u=S.J,f=u.mainPlaylistEntity,H=u.KLC,v=f1q(f,(k=H)==null?void 0:k.avatar),g.Ef(S,4),g.q(S,zU(v),6);case 6:g.MP(S,5);break;case 4:W=g.K2(S),W instanceof Error&&W.message==="Failed to fetch"&&DY(W.message);case 5:return S.return(X[0].videos)}})},aeV=function(J,R,N,C){var X,u,f,H,k,v,W,S,L,I,F,a,n,B,Z,A,V;
return g.Y(function(p){switch(p.K){case 1:X=Date.now().toString();N||(N=X);u=R.videos;f=R.playlistId;H=[];k=[];if(u)for(v=g.K(u),W=v.next();!W.done;W=v.next()){S=W.value;L=S.offlineVideoData;if(!L||!L.videoId)throw DY("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");I=L.videoId;F={videoId:I,playlistId:f};a={id:g.DR(JSON.stringify(F),"mainPlaylistVideoEntity"),video:g.DR(I,"mainVideoEntity")};H.push(a);k.push(a.id)}B={key:g.DR(f,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:N,lastSyncedTimestampMillis:X};Z={key:g.DR(f,"mainPlaylistEntity"),playlistId:f,videos:k,title:R.title,thumbnailStyleData:QcJ(R),visibility:nIE(R),downloadState:B.key};R.channel&&(A=R.channel.offlineChannelData,n=DYk(g.DR(f,"ytMainChannelEntity"),A),Z.channelOwner=n.id);((V=Z)==null?0:V.entityMetadata)?(Z.entityMetadata.offlineLastModifiedTimestampSeconds=R.lastModifiedTimestamp,C&&(Z.entityMetadata.nextAutoRefreshIntervalSeconds=String(C))):Z&&(Z.entityMetadata={nextAutoRefreshIntervalSeconds:C?
String(C):void 0,offlineLastModifiedTimestampSeconds:R.lastModifiedTimestamp});g.Ef(p,2);return g.q(p,I0(J.K,{mode:"readwrite",QK:!0},function(b){var w=v4(b,Z,"mainPlaylistEntity"),RQ=v4(b,B,"mainPlaylistDownloadStateEntity");w=[w,RQ];RQ=g.K(H);for(var $E=RQ.next();!$E.done;$E=RQ.next())w.push(v4(b,$E.value,"mainPlaylistVideoEntity"));n&&w.push(v4(b,n,"ytMainChannelEntity"));return g.r9.all(w)}),4);
case 4:g.MP(p,3);break;case 2:throw g.K2(p),DY("PES failure for playlist"),Error("PES failure for playlist");case 3:return p.return({mainPlaylistEntity:Z,KLC:n,umC:H})}})},DYk=function(J,R){return{id:J,
channelId:R.channelId,title:R.title,avatar:R.thumbnail}},QcJ=function(J){var R=[],N=J.videos;
N&&N.length>0&&R.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:N[0].offlineVideoData.thumbnail}}});if((J=J.additionalMetadadatas)&&J.length>0)for(J=g.K(J),N=J.next();!N.done;N=J.next()){var C=N.value.offlineBundleItemPlaylistData,X=void 0;N=(X=C)==null?void 0:X.style;X=void 0;C={collageThumbnail:{coverThumbnail:(X=C)==null?void 0:X.coverThumbnail}};switch(N){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":R.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:C});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":R.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:C});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":R.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:C});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":R.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:C})}}return R},nIE=function(J){switch(J.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},Iea=function(J,R,N){R={offlineVideoData:R,
playlistId:N};if(J=g.z(J.actionMetadata,EIa))R.maximumDownloadQuality=J.maximumDownloadQuality;return{mainVideoEntityActionMetadata:R}},sc9=function(J,R,N){this.K=J;
this.KC=R;this.V=N},ZIl=function(J,R){var N,C,X,u,f,H,k,v,W,S,L,I,F;
return g.Y(function(a){switch(a.K){case 1:return N=qe(R),C=g.nX(R.entityKey),X=C.entityId,u=g.z(R.actionMetadata,I7),H=!((f=u)==null?0:f.playlistId),g.Ef(a,2),g.q(a,BJ8(J,X,void 0,(k=u)==null?void 0:k.offlineVideoData,H),4);case 4:g.MP(a,3);break;case 2:return v=g.K2(a),W="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.B9&&v.type==="QUOTA_EXCEEDED"&&(W="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
a.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,W,S));case 3:L=1;L=Number(((I=R.actionMetadata)==null?void 0:I.priority)||0)+1;var n=(n=g.z(R.actionMetadata,I7))?{playbackDataActionMetadata:{maximumDownloadQuality:n.maximumDownloadQuality}}:void 0;F=o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",X,"playbackData",L,OI9,n);return a.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N,[F]))}})},dYf=function(J,R){var N,C,X,u,f,H,k,v,W,S,L,I,F,a,n,B,Z;
return g.Y(function(A){switch(A.K){case 1:return N=qe(R),C=g.nX(R.entityKey),X=C.entityId,g.q(A,EP(J.K,R.entityKey,"mainVideoEntity"),2);case 2:u=A.J;if(!u){f=void 0;A.ZM(3);break}return g.q(A,EP(J.K,u.downloadState,"mainVideoDownloadStateEntity"),4);case 4:f=A.J;case 3:H=f;if(!u||!H)return A.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N));g.Ef(A,5);return g.q(A,BJ8(J,X,H.addedTimestampMillis,(v=g.z(R.actionMetadata,I7))==null?void 0:v.offlineVideoData),7);case 7:W=1;W=Number(((S=
R.actionMetadata)==null?void 0:S.priority)||0)+1;k=o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",X,"playbackData",W,OI9);g.MP(A,6);break;case 5:L=g.K2(A);if(!(L instanceof Error&&L.message==="No data")){if(L instanceof Error&&L.message==="Empty response body")DY(L.message);else return I="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",L instanceof g.B9&&L.type==="QUOTA_EXCEEDED"&&(I="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),A.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,I,F));A.ZM(6);break}return g.q(A,c4(J.K,X),9);case 9:a=A.J;n=g.z(R.actionMetadata,I7);if(Z=(B=n)==null?void 0:B.playlistId)a.playlistId=Z;a.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.q(A,ek(X,J.K,R,J.V,a),6);case 6:return A.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N,k?[k]:void 0))}})},q7J=function(J,R){var N,C,X,u,f,H,k,v,W,S;
return g.Y(function(L){switch(L.K){case 1:return N=qe(R),g.Ef(L,2),C=g.nX(R.entityKey).entityId,C==="!*$_ALL_ENTITIES_!*$"?g.q(L,k6a(J.K,R,J.V,(W=R.actionMetadata)==null?void 0:(S=W.offlineLoggingData)==null?void 0:S.offlineDeleteReason),5):g.q(L,c4(J.K,C),6);case 6:X=L.J;u=g.z(R.actionMetadata,I7);if(H=(f=u)==null?void 0:f.playlistId)X.playlistId=H;X.offlineDeleteReason=(k=R.actionMetadata)==null?void 0:(v=k.offlineLoggingData)==null?void 0:v.offlineDeleteReason;return g.q(L,ek(C,J.K,R,J.V,X),7);
case 7:if(!J.KC.T("woffle_enable_main_downloads_library")){L.ZM(5);break}return g.q(L,EHV(J.K,R.entityKey),5);case 5:g.MP(L,3);break;case 2:return g.K2(L),L.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return L.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N))}})},BJ8=function(J,R,N,C,X){var u,f,H,k,v,W;
return g.Y(function(S){switch(S.K){case 1:if(u=C){S.ZM(2);break}return g.q(S,Zak([R]),3);case 3:f=S.J,u=f[0];case 2:return g.q(S,Afq(J,u,N,X),4);case 4:H=S.J;k=H.mainVideoEntity;v=H.channelEntity;g.Ef(S,5);var L=gR(k.thumbnail),I=gR(v.avatar);return g.q(S,zU(L.concat(I)),7);case 7:g.MP(S,0);break;case 5:W=g.K2(S),W instanceof Error&&W.message==="Failed to fetch"&&DY(W.message),g.IQ(S)}})},Afq=function(J,R,N,C){var X,u,f,H,k,v,W,S,L,I,F,a,n;
return g.Y(function(B){switch(B.K){case 1:N||(N=Date.now().toString());u=(X=R.channel)==null?void 0:X.offlineChannelData;f={id:g.DR(R.videoId,"ytMainChannelEntity"),channelId:u.channelId,title:u.title,avatar:u.thumbnail};H={key:g.DR(R.videoId,"mainVideoDownloadStateEntity"),playbackData:g.DR(R.videoId,"playbackData"),addedTimestampMillis:N,videoDownloadContextEntity:g.DR(R.videoId,"videoDownloadContextEntity")};k={key:g.DR(R.videoId,"videoPlaybackPositionEntity"),videoId:R.videoId,lastPlaybackPositionSeconds:"0"};
J.KC.T("html5_offline_playback_position_sync")&&(v={playbackPosition:k.key});W=g.DR(R.videoId,"mainVideoEntity");S={key:W,videoId:R.videoId,title:R.title,thumbnail:R.thumbnail,localizedStrings:{viewCount:R.shortViewCountText},userState:v,lengthSeconds:R.lengthSeconds?Number(R.lengthSeconds):void 0,publishedTimestampMillis:R.publishedTimestamp?(Number(R.publishedTimestamp)*1E3).toString():void 0,formattedDescription:R.description,owner:f.id,downloadState:H.key};if(!J.KC.T("woffle_enable_main_downloads_library")||
!C){B.ZM(2);break}return g.q(B,I1_(J.K,[W]),3);case 3:if(F=B.J)L=F.mainDownloadsLibraryEntity,I=F.mainDownloadsListEntity;case 2:return n=RpE,a={key:g.DR(R.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.ol(H,n,a),g.q(B,I0(J.K,{mode:"readwrite",QK:!0},function(Z){var A=v4(Z,f,"ytMainChannelEntity"),V=v4(Z,H,"mainVideoDownloadStateEntity"),p=v4(Z,S,"mainVideoEntity");A=[A,V,p];J.KC.T("html5_offline_playback_position_sync")&&(V=v4(Z,k,"videoPlaybackPositionEntity"),
A.push(V));L&&(V=v4(Z,L,"mainDownloadsLibraryEntity"),A.push(V));I&&(V=v4(Z,I,"mainDownloadsListEntity"),A.push(V));a&&(Z=v4(Z,a,"downloadStatusEntity"),A.push(Z));return g.r9.all(A)}),4);
case 4:return B.return({mainVideoEntity:S,channelEntity:f})}})},Y7K=function(J,R,N){this.K=J;
this.KC=R;this.V=N},jc_=function(J,R){var N,C,X,u,f,H,k,v,W,S,L,I,F,a,n,B,Z,A,V,p,b,w,RQ,$E,G,e,t;
return g.Y(function(E){switch(E.K){case 1:return N=qe(R),C=[],g.q(E,uQ.getInstance(),2);case 2:X=E.J;if(!X){E.ZM(3);break}return g.q(E,X.get("sdois"),4);case 4:return u=E.J,g.q(E,(H=X)==null?void 0:H.get("lmqf"),5);case 5:f=E.J;case 3:g.Ef(E,6);if(u===void 0)throw Error("prefStorage or opt-in state is undefined");k=[];if(u){E.ZM(8);break}return g.q(E,L6f(J.K),9);case 9:k=E.J,k.reverse();case 8:if(!k.length){E.ZM(10);break}v=g.K(k);W=v.next();case 11:if(W.done){E.ZM(10);break}S=W.value;if(!S){E.ZM(12);
break}L=g.nX(S).entityId;return g.q(E,c4(J.K,L),14);case 14:return I=E.J,I.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.q(E,ek(L,J.K,{entityKey:S,actionType:R.actionType},J.V,I),12);case 12:W=v.next();E.ZM(11);break;case 10:return g.q(E,rH_(u,(F=f)!=null?F:"SD"),16);case 16:return a=E.J,g.q(E,vHJ(a),17);case 17:n=S0a(a);if(!J.KC.T("woffle_enable_main_downloads_library")){E.ZM(18);break}if(u){E.ZM(19);break}return g.q(E,EHV(J.K,g.$_),19);case 19:return g.q(E,F6V(J.K,[g.$_]),18);
case 18:if((B=n)==null?0:B.length)for(Z=g.K(n),A=Z.next();!A.done;A=Z.next())if(p=V=A.value,b=p.actionType,w=p.entityKey,RQ=p.actionMetadata,b&&w&&RQ&&!g.z(RQ,rfP)){b==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(RQ.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if($E=g.z(V.actionMetadata,I7))$E.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",V.actionMetadata=Object.assign({},V.actionMetadata,{mainVideoEntityActionMetadata:$E});C.push(V)}g.MP(E,7);break;
case 6:return G=g.K2(E),e="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.B9&&G.type==="QUOTA_EXCEEDED"&&(e="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),E.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,e,t));case 7:return E.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N,C))}})},mYa=function(){WL.apply(this,arguments);
this.W="mainVideoEntity"},V0E=function(J,R,N){R=R===void 0?43200:R;
N=N===void 0?!0:N;var C=C===void 0?!1:C;var X,u,f;return g.Y(function(H){switch(H.K){case 1:if(!J.S.Tj())return H.return([]);X=[];g.Ef(H,2);return g.q(H,AHq(R,N,C),4);case 4:X=H.J;g.MP(H,3);break;case 2:u=g.K2(H),u instanceof Error&&u.message==="No data"||u instanceof Error&&u.message==="Empty response body"&&DY(u.message);case 3:return f=vIJ(J,X,N,"mainPlaylistEntity"),H.return(f)}})},gId=function(J,R,N,C){C=C===void 0?!1:C;
var X,u,f,H,k,v,W,S,L,I,F,a,n,B,Z;return g.Y(function(A){switch(A.K){case 1:return X=[],g.q(A,Y0E(),2);case 2:return(u=A.J)||C?g.q(A,jp_(R,N),3):A.return([]);case 3:f=A.J;if((H=f)==null||!H.length)return A.return([]);k={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};v=g.K(f);W=v.next();case 4:if(W.done){A.ZM(6);break}L=S=W.value;I=L.actionType;F=L.entityKey;a=L.actionMetadata;if(!(I&&F&&a)||g.z(a,rfP)){A.ZM(5);break}I==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(a.offlineLoggingData=
k);n=g.nX(F);B=n.entityId;return g.q(A,SX(J,[B],"mainVideoEntity",I,a),8);case 8:Z=A.J,X=X.concat(Z);case 5:W=v.next();A.ZM(4);break;case 6:return A.return(X)}})},UYV=function(J,R){this.K=J;
this.V=R},leq=function(J,R){var N,C,X,u,f,H,k,v,W,S,L,I,F,a,n,B;
return g.Y(function(Z){switch(Z.K){case 1:return N=qe(R),C=g.nX(R.entityKey),X=C.entityId,u=[],g.Ef(Z,2),g.q(Z,p1K(J,X),4);case 4:u=Z.J;if((f=u)==null||!f.length){Z.ZM(5);break}return g.q(Z,nHP(J.K,R.entityKey),5);case 5:g.MP(Z,3);break;case 2:return H=g.K2(Z),k="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.B9&&H.type==="QUOTA_EXCEEDED"&&(k="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Z.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,k,v));case 3:return W=[],g.q(Z,NlV(J.K,"musicTrack",u),7);case 7:u=Z.J;if(u.length)for(S=g.K(u),L=S.next();!L.done;L=S.next())if(I=L.value,F=I.offlineVideoData,a=void 0,(a=F)==null?0:a.videoId)n=void 0,B=Number(((n=R.actionMetadata)==null?void 0:n.priority)||0)+1,W.push(o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",F.videoId,"musicTrack",B,FF,bQ(R,F,X)));return Z.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N,W))}})},
P4f=function(J,R){var N,C,X,u,f,H,k,v,W,S,L,I,F,a,n,B,Z,A,V,p,b,w,RQ,$E,G,e,t,E,y,b8,FV,Hl,Of,oU,SE,tk,D,O,d,r,U,Jk,i8,C2,m,Hg,FB,u8,jn,uP,p8,vb,cg,mS,vh,li,Ph,eF,Dr;
return g.Y(function(zs){switch(zs.K){case 1:return N=qe(R),C=R.entityKey,X=g.nX(C).entityId,u=[],f=!1,X==="!*$_ALL_ENTITIES_!*$"?(f=!0,g.q(zs,Me(J.K,"musicAlbumRelease"),5)):g.q(zs,EP(J.K,C,"musicAlbumRelease"),4);case 4:(H=zs.J)&&u.push(H);zs.ZM(3);break;case 5:u=zs.J;case 3:if((k=u)==null||!k.length)return zs.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N));if(f){v=[];W=g.K(u);for(S=W.next();!S.done;S=W.next())L=S.value,I=g.nX(L.id).entityId,v.push(o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
I,"musicAlbumRelease",0,FF));return zs.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N,v))}F=[];a=u[0];n=void 0;if(!a.downloadMetadata){zs.ZM(6);break}return g.q(zs,EP(J.K,a.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:B=zs.J,n=Number((A=(Z=B)==null?void 0:Z.addedTimestampMillis)!=null?A:"0")/1E3;case 6:return g.Ef(zs,8),g.q(zs,p1K(J,X,(V=n)==null?void 0:V.toString()),10);case 10:F=zs.J;g.MP(zs,9);break;case 8:p=g.K2(zs);if(!(p instanceof Error&&p.message===
"No data")){if(p instanceof Error&&p.message==="Empty response body")DY(p.message);else return b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",p instanceof g.B9&&p.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),zs.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,b,w));zs.ZM(9);break}return g.q(zs,yQ(X,"musicAlbumRelease",J.K,
R,J.V),9);case 9:RQ=[];$E=new Map;if((G=F)==null?0:G.length)for(e=g.K(F),t=e.next();!t.done;t=e.next())E=t.value,y=E.offlineVideoData,b8=void 0,((b8=y)==null?0:b8.videoId)&&$E.set(y.videoId,y);FV=new Map;Hl=[];if((Of=a)==null?0:(oU=Of.tracks)==null?0:oU.length)for(SE=g.K(a.tracks),tk=SE.next();!tk.done;tk=SE.next())if(D=tk.value,O=g.nX(D).entityId)$E.has(O)?(FV.set(O,$E.get(O)),$E.delete(O)):Hl.push(O);r=Number(((d=R.actionMetadata)==null?void 0:d.priority)||0)+1;U=g.K($E.entries());for(Jk=U.next();!Jk.done;Jk=
U.next())i8=Jk.value,C2=g.K(i8),m=C2.next().value,Hg=C2.next().value,FB=m,u8=Hg,RQ.push(o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",FB,"musicTrack",r,FF,bQ(R,u8)));jn=g.K(FV.entries());for(uP=jn.next();!uP.done;uP=jn.next())p8=uP.value,vb=g.K(p8),cg=vb.next().value,mS=vb.next().value,vh=cg,li=mS,RQ.push(o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",vh,"musicTrack",r,FF,bQ(R,li)));Ph=g.K(Hl);for(eF=Ph.next();!eF.done;eF=Ph.next())Dr=eF.value,RQ.push(o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Dr,
"musicTrack",0,FF));return zs.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N,RQ))}})},zmk=function(J,R){var N,C;
return g.Y(function(X){switch(X.K){case 1:return N=qe(R),g.Ef(X,2),C=g.nX(R.entityKey).entityId,C==="!*$_ALL_ENTITIES_!*$"?g.q(X,GU(J.K,R,J.V),5):g.q(X,yQ(C,"musicAlbumRelease",J.K,R,J.V),6);case 6:return g.q(X,D0k(J.K,R.entityKey),5);case 5:g.MP(X,3);break;case 2:return g.K2(X),X.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return X.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
N))}})},p1K=function(J,R,N){var C,X,u;
return g.Y(function(f){switch(f.K){case 1:return g.q(f,d0J([R]),2);case 2:return C=f.J,g.q(f,emq(J,C[0],N),3);case 3:return X=f.J,u=gR(X.thumbnailDetails),g.q(f,zU(u),4);case 4:return f.return(C[0].videos)}})},emq=function(J,R,N){var C,X,u,f,H,k,v,W,S,L,I,F,a,n;
return g.Y(function(B){if(B.K==1){C=R.additionalMetadadatas;X=void 0;if(C&&C.length>0)for(u=g.K(C),f=u.next();!f.done;f=u.next())if(H=f.value,H.offlineMusicPlaylistData){X=H.offlineMusicPlaylistData;break}k=R.playlistId;v=spE(R);W=v.Kv;S=v.wA;L=N?(Number(N)*1E3).toString():Date.now().toString();I=R.lastModifiedTimestamp?(Number(R.lastModifiedTimestamp)*1E3).toString():"0";F={id:g.DR(k,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:S,lastModifiedTimestampMillis:I,addedTimestampMillis:L,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};a={id:g.DR(k,"musicAlbumRelease"),title:R.title,audioPlaylistId:k,trackCount:R.totalVideoCount,tracks:W,downloadMetadata:F.id};X&&(a.thumbnailDetails=(n=X.albumHqThumbnail)!=null?n:X.albumArtistThumbnail,a.artistDisplayName=X.albumArtistDisplayName,a.releaseDate=X.albumReleaseDate,a.contentRating={explicitType:X.albumReleaseExplicitType},a.releaseType=X.albumReleaseType);return g.q(B,I0(J.K,{mode:"readwrite",QK:!0},function(Z){var A=v4(Z,a,"musicAlbumRelease");
Z=v4(Z,F,"musicAlbumReleaseDownloadMetadataEntity");return g.r9.all([A,Z])}),2)}return B.return(a)})},w1q=function(J,R){this.K=J;
this.V=R},hmq=function(J,R){var N,C,X,u,f,H,k,v,W,S,L,I,F,a,n,B;
return g.Y(function(Z){switch(Z.K){case 1:return N=qe(R),C=g.nX(R.entityKey),X=C.entityId,u=[],g.Ef(Z,2),g.q(Z,cfU(J,X),4);case 4:u=Z.J;if((f=u)==null||!f.length){Z.ZM(5);break}return g.q(Z,nHP(J.K,R.entityKey),5);case 5:g.MP(Z,3);break;case 2:return H=g.K2(Z),k="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.B9&&H.type==="QUOTA_EXCEEDED"&&(k="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Z.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,k,v));case 3:return W=[],g.q(Z,NlV(J.K,"musicTrack",u),7);case 7:u=Z.J;if(u.length)for(S=g.K(u),L=S.next();!L.done;L=S.next())if(I=L.value,F=I.offlineVideoData,a=void 0,(a=F)==null?0:a.videoId)n=void 0,B=Number(((n=R.actionMetadata)==null?void 0:n.priority)||0)+1,W.push(o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",F.videoId,"musicTrack",B,E3,bQ(R,F,X)));return Z.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N,W))}})},
yf8=function(J,R){var N,C,X,u,f,H,k,v,W,S,L,I,F,a,n,B,Z,A,V,p,b,w,RQ,$E,G,e,t,E,y,b8,FV,Hl,Of,oU,SE,tk,D,O,d,r,U,Jk,i8,C2,m,Hg,FB,u8,jn,uP,p8,vb,cg,mS,vh,li,Ph,eF,Dr,zs,bu,wq,LK,gt,Vt,L6,Us,cO,gZ,uf,s2;
return g.Y(function(X9){switch(X9.K){case 1:return N=qe(R),C=R.entityKey,X=g.nX(C).entityId,u=[],f=!1,X==="!*$_ALL_ENTITIES_!*$"?(f=!0,g.q(X9,Me(J.K,"musicPlaylist"),5)):g.q(X9,EP(J.K,C,"musicPlaylist"),4);case 4:(H=X9.J)&&u.push(H);X9.ZM(3);break;case 5:u=X9.J;case 3:if((k=u)==null||!k.length)return X9.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N));v=g.z(R.actionMetadata,BlL);S=(W=v)==null?void 0:W.autoSync;L=[];F=I=!0;a=!1;n=void 0;if(!f&&S===!1){X9.ZM(6);break}g.Ef(X9,7);return g.q(X9,
m0f(0,!!S,!0,u),9);case 9:L=X9.J;g.MP(X9,8);break;case 7:B=g.K2(X9);if(!(B instanceof Error&&B.message==="No data")){B instanceof Error&&B.message==="Empty response body"&&DY(B.message);X9.ZM(8);break}return X==="!*$_ALL_ENTITIES_!*$"?g.q(X9,GU(J.K,R,J.V),8):g.q(X9,yQ(X,"musicPlaylist",J.K,R,J.V),8);case 8:if(!L.length||!f&&L[0].playlistId!==X)return X9.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N));case 6:if(f){Z=[];A=g.K(L);for(V=A.next();!V.done;V=A.next())p=V.value,p.upToDate||
S&&!p.shouldAutoSyncMetadata||!p.playlistId||(b={autoSync:S},Z.push(o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",p.playlistId,"musicPlaylist",0,E3,{musicPlaylistEntityActionMetadata:b})));return X9.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N,Z))}L.length&&(w=L[0],a=!!w.upToDate,S&&(I=(RQ=w.shouldAutoSyncMetadata)!=null?RQ:!0,F=($E=w.shouldAutoSyncVideos)!=null?$E:!0,w.checkInSeconds&&(n=w.checkInSeconds)));if(a||!I)return X9.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
N));G=[];e=u[0];t=void 0;if(!e.downloadMetadata){X9.ZM(15);break}return g.q(X9,EP(J.K,e.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:E=X9.J,t=Number((b8=(y=E)==null?void 0:y.addedTimestampMillis)!=null?b8:"0")/1E3;case 15:return g.Ef(X9,17),g.q(X9,cfU(J,X,(FV=t)==null?void 0:FV.toString(),n),19);case 19:G=X9.J;g.MP(X9,18);break;case 17:Hl=g.K2(X9);if(!(Hl instanceof Error&&Hl.message==="No data")){if(Hl instanceof Error&&Hl.message==="Empty response body")DY(Hl.message);else return Of=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",oU="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Hl instanceof g.B9&&Hl.type==="QUOTA_EXCEEDED"&&(Of="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",oU="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),X9.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,Of,oU));X9.ZM(18);break}return g.q(X9,yQ(X,"musicPlaylist",J.K,R,J.V),18);case 18:if(!F)return X9.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
N));SE=[];tk=new Map;if((D=G)==null?0:D.length)for(O=g.K(G),d=O.next();!d.done;d=O.next())r=d.value,U=r.offlineVideoData,Jk=void 0,((Jk=U)==null?0:Jk.videoId)&&tk.set(U.videoId,U);i8=new Map;C2=[];if((m=e)==null?0:(Hg=m.tracks)==null?0:Hg.length)for(FB=g.K(e.tracks),u8=FB.next();!u8.done;u8=FB.next())if(jn=u8.value,uP=g.nX(jn).entityId)tk.has(uP)?(i8.set(uP,tk.get(uP)),tk.delete(uP)):C2.push(uP);vb=Number(((p8=R.actionMetadata)==null?void 0:p8.priority)||0)+1;cg=g.K(tk.entries());for(mS=cg.next();!mS.done;mS=
cg.next())vh=mS.value,li=g.K(vh),Ph=li.next().value,eF=li.next().value,Dr=Ph,zs=eF,SE.push(o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Dr,"musicTrack",vb,E3,bQ(R,zs)));bu=g.K(i8.entries());for(wq=bu.next();!wq.done;wq=bu.next())LK=wq.value,gt=g.K(LK),Vt=gt.next().value,L6=gt.next().value,Us=Vt,cO=L6,SE.push(o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Us,"musicTrack",vb,E3,bQ(R,cO)));gZ=g.K(C2);for(uf=gZ.next();!uf.done;uf=gZ.next())s2=uf.value,SE.push(o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
s2,"musicTrack",0,E3));return X9.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N,SE))}})},Gm9=function(J,R){var N,C;
return g.Y(function(X){switch(X.K){case 1:return N=qe(R),g.Ef(X,2),C=g.nX(R.entityKey).entityId,C==="!*$_ALL_ENTITIES_!*$"?g.q(X,GU(J.K,R,J.V),5):g.q(X,yQ(C,"musicPlaylist",J.K,R,J.V),6);case 6:return g.q(X,D0k(J.K,R.entityKey),5);case 5:g.MP(X,3);break;case 2:return g.K2(X),X.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return X.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
N))}})},cfU=function(J,R,N,C){var X,u,f;
return g.Y(function(H){switch(H.K){case 1:return g.q(H,d0J([R]),2);case 2:return X=H.J,g.q(H,bIE(J,X[0],N,C),3);case 3:return u=H.J,f=gR(u.thumbnailDetails),g.q(H,zU(f),4);case 4:return H.return(X[0].videos)}})},bIE=function(J,R,N,C){var X,u,f,H,k,v,W,S,L;
return g.Y(function(I){return I.K==1?(X=R.playlistId,u=spE(R),f=u.Kv,H=u.wA,k=N?(Number(N)*1E3).toString():Date.now().toString(),v=R.lastModifiedTimestamp?(Number(R.lastModifiedTimestamp)*1E3).toString():"0",W={id:g.DR(X,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:H,lastModifiedTimestampMillis:v,addedTimestampMillis:k,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},S={id:g.DR(X,"musicPlaylist"),title:R.title,playlistId:X,thumbnailDetails:R.thumbnail,visibility:t0q(R),trackCount:R.totalVideoCount,
tracks:f,downloadMetadata:W.id},C&&(((L=S)==null?0:L.entityMetadata)?S.entityMetadata.nextAutoRefreshIntervalSeconds=String(C):S&&(S.entityMetadata={nextAutoRefreshIntervalSeconds:String(C)})),g.q(I,I0(J.K,{mode:"readwrite",QK:!0},function(F){var a=v4(F,S,"musicPlaylist");F=v4(F,W,"musicPlaylistDownloadMetadataEntity");return g.r9.all([a,F])}),2)):I.return(S)})},t0q=function(J){switch(J.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},xYJ=function(J,R){this.K=J;
this.V=R},N9U=function(J,R){var N,C,X,u,f,H,k,v,W,S,L,I,F;
return g.Y(function(a){switch(a.K){case 1:return N=qe(R),C=g.nX(R.entityKey),X=C.entityId,u=g.z(R.actionMetadata,JCV),g.Ef(a,2),g.q(a,o99(J,X,void 0,(f=u)==null?void 0:f.track,(H=u)==null?void 0:H.albumRelease),4);case 4:if((k=u)==null?0:k.playlistId){a.ZM(5);break}return g.q(a,nHP(J.K,R.entityKey),5);case 5:g.MP(a,3);break;case 2:return v=g.K2(a),W="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.B9&&v.type==="QUOTA_EXCEEDED"&&
(W="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),a.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,W,S));case 3:I=Number(((L=R.actionMetadata)==null?void 0:L.priority)||0)+1;var n=(n=g.z(R.actionMetadata,JCV))?{playbackDataActionMetadata:{maximumDownloadQuality:n.maximumDownloadQuality}}:void 0;F=o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",X,"playbackData",I,R4K,n);return a.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
N,[F]))}})},CS9=function(J,R){var N,C,X,u,f,H,k,v,W,S,L,I,F,a,n;
return g.Y(function(B){switch(B.K){case 1:return N=qe(R),C=g.nX(R.entityKey),X=C.entityId,g.q(B,EP(J.K,R.entityKey,"musicTrack"),2);case 2:u=B.J;if(!u){f=void 0;B.ZM(3);break}return g.q(B,EP(J.K,u.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:f=B.J;case 3:H=f;if(!u||!H)return B.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N));v=g.z(R.actionMetadata,JCV);g.Ef(B,5);return g.q(B,o99(J,X,H.addedTimestampMillis,(W=v)==null?void 0:W.track,(S=v)==null?void 0:S.albumRelease),
7);case 7:I=Number(((L=R.actionMetadata)==null?void 0:L.priority)||0)+1;k=o7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",X,"playbackData",I,R4K);g.MP(B,6);break;case 5:F=g.K2(B);if(!(F instanceof Error&&F.message==="No data")){if(F instanceof Error&&F.message==="Empty response body")DY(F.message);else return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.B9&&F.type==="QUOTA_EXCEEDED"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
n="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),B.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,a,n));B.ZM(6);break}return g.q(B,hu(X,J.K,R,J.V),6);case 6:return B.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",N,k?[k]:void 0))}})},X9E=function(J,R){var N,C;
return g.Y(function(X){switch(X.K){case 1:return N=qe(R),g.Ef(X,2),C=g.nX(R.entityKey).entityId,C==="!*$_ALL_ENTITIES_!*$"?g.q(X,GU(J.K,R,J.V),5):g.q(X,hu(C,J.K,R,J.V),6);case 6:return g.q(X,D0k(J.K,R.entityKey),5);case 5:g.MP(X,3);break;case 2:return g.K2(X),X.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",N,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return X.return(new R7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
N))}})},o99=function(J,R,N,C,X){var u,f,H,k,v,W;
return g.Y(function(S){switch(S.K){case 1:if(u=C){S.ZM(2);break}return g.q(S,Zak([R]),3);case 3:f=S.J,H=f[0],u=QpE(H);case 2:return g.q(S,i3l(J,u,R,X,N),4);case 4:k=S.J;v=k.musicTrackEntity;W=k.Lq;var L=gR(v.thumbnailDetails),I=[];W&&(I=gR(W.thumbnailDetails));return g.q(S,zU(L.concat(I)),0)}})},i3l=function(J,R,N,C,X){var u;
return g.Y(function(f){return f.K==1?(X||(X=Date.now().toString()),u={id:g.DR(N,"musicTrackDownloadMetadataEntity"),playbackData:g.DR(N,"playbackData"),addedTimestampMillis:X,videoDownloadContextEntity:g.DR(N,"videoDownloadContextEntity")},C&&(R.albumRelease=C.id),g.q(f,I0(J.K,{mode:"readwrite",QK:!0},function(H){var k=[],v=v4(H,u,"musicTrackDownloadMetadataEntity");k.push(v);v=v4(H,R,"musicTrack");k.push(v);C&&(H=v4(H,C,"musicAlbumRelease"),k.push(H));return g.r9.all(k)}),2)):f.K!=3?g.q(f,jk(N,"musicTrackDownloadMetadataEntity",
J.K,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):f.return({musicTrackEntity:R,
Lq:C})})},MG=function(){WL.apply(this,arguments);
this.W="musicTrack"},uUK=function(J,R,N){R=R===void 0?43200:R;
N=N===void 0?!0:N;var C=C===void 0?!1:C;var X,u;return g.Y(function(f){switch(f.K){case 1:if(!J.S.Tj())return f.return([]);X=[];g.Ef(f,2);return g.q(f,m0f(R,N,C),4);case 4:X=f.J;g.MP(f,3);break;case 2:g.K2(f);case 3:return u=vIJ(J,X,N,"musicPlaylist"),f.return(u)}})},fI8=function(){g.Sx.apply(this,arguments);
var J=this;this.events=new g.tY(this);this.KC=this.player.N();this.QR={X_a:function(){return J.K},
ON:function(){return J.ON()},
nU:function(R){return J.nU(R)}}},T9a=function(J){var R;
J=g.z((R=J.getWatchNextResponse())==null?void 0:R.currentVideoEndpoint,g.WJ);if(J==null?0:J.playlistId)var N=J.playlistId;return N},$zd=function(J,R){var N,C,X,u;
return g.Y(function(f){if(f.K==1){N=R.clientPlaybackNonce;C={cpn:N,offlineSourceVisualElement:g.VD(R.VO||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};R.J&&(C.videoFmt=Number(R.J.itag));R.Z&&(C.audioFmt=Number(R.Z.itag));if((X=T9a(R))&&R.videoId){var H=R.videoId;H=X!=="PPSV"?Promise.resolve(!1):J.K.mJ(H);f=g.q(f,H,3)}else f=f.ZM(2);return f}f.K!=2&&(u=f.J)&&(C.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");J.J=N;g.Mz("offlinePlaybackStarted",C);g.IQ(f)})};
g.M(X4,Cx);g.XB.Object.defineProperties(X4.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.K.entityMetadata},
set:function(J){this.K.entityMetadata=J}}});
g.M(TbK,X4);TbK.prototype.J=function(){return[]};
g.M($WL,X4);$WL.prototype.J=function(){return[]};
g.M(HHJ,X4);HHJ.prototype.J=function(){return[]};
g.M(k4d,X4);k4d.prototype.J=function(){var J=[];this.K.alternateChannel&&J.push(this.K.alternateChannel);this.K.alternateChannelList&&J.push.apply(J,g.Q(this.K.alternateChannelList));this.K.oneofChannelEntity&&J.push(this.K.oneofChannelEntity);return[].concat(g.Q(new Set(J)))};
g.M(vZf,X4);vZf.prototype.J=function(){var J=[];this.K.entryCollection&&J.push(this.K.entryCollection);return[].concat(g.Q(new Set(J)))};
g.M(Wna,Cx);Wna.prototype.J=function(){var J=[];this.K.video&&J.push(this.K.video);return[].concat(g.Q(new Set(J)))};
g.M(Sk8,X4);Sk8.prototype.J=function(){var J=[];this.K.parentPlaylist&&J.push(this.K.parentPlaylist);if(this.K.entries)for(var R=g.K(this.K.entries),N=R.next();!N.done;N=R.next())J.push.apply(J,g.Q((new Wna(N.value)).J()));return[].concat(g.Q(new Set(J)))};
g.M(LnK,X4);LnK.prototype.J=function(){var J=[];this.K.descriptionEntity&&J.push(this.K.descriptionEntity);this.K.creators&&J.push.apply(J,g.Q(this.K.creators));this.K.theBiggestFan&&J.push(this.K.theBiggestFan);return[].concat(g.Q(new Set(J)))};
g.M(Iya,X4);Iya.prototype.J=function(){return[]};
g.M(Fnl,X4);Fnl.prototype.J=function(){return[]};
g.M(EZ9,X4);EZ9.prototype.J=function(){return[]};
g.M(MAf,X4);MAf.prototype.J=function(){return[]};
g.M(Kn8,X4);Kn8.prototype.J=function(){return[]};
g.M(ayl,X4);ayl.prototype.J=function(){return[]};
g.M(QME,X4);QME.prototype.J=function(){return[]};
g.M(nZV,X4);nZV.prototype.J=function(){return[]};
g.M(DWJ,X4);DWJ.prototype.J=function(){return[]};
g.M(sMd,X4);sMd.prototype.J=function(){var J=[];this.K.downloadsList&&J.push(this.K.downloadsList);this.K.smartDownloadsList&&J.push(this.K.smartDownloadsList);this.K.recommendedDownloadsList&&J.push(this.K.recommendedDownloadsList);this.K.refresh&&J.push(this.K.refresh);return[].concat(g.Q(new Set(J)))};
g.M(BbV,Cx);BbV.prototype.J=function(){var J=[];this.K.video&&J.push(this.K.video);this.K.playlist&&J.push(this.K.playlist);this.K.videoItem&&J.push(this.K.videoItem);this.K.playlistItem&&J.push(this.K.playlistItem);return[].concat(g.Q(new Set(J)))};
g.M(OHa,X4);OHa.prototype.J=function(){var J=[];this.K.refresh&&J.push(this.K.refresh);if(this.K.downloads)for(var R=g.K(this.K.downloads),N=R.next();!N.done;N=R.next())J.push.apply(J,g.Q((new BbV(N.value)).J()));return[].concat(g.Q(new Set(J)))};
g.M(ZHJ,X4);ZHJ.prototype.J=function(){var J=[];this.K.localImageEntities&&J.push.apply(J,g.Q(this.K.localImageEntities));return[].concat(g.Q(new Set(J)))};
g.M(dWf,X4);dWf.prototype.J=function(){var J=[];this.K.playbackData&&J.push(this.K.playbackData);this.K.localImageEntities&&J.push.apply(J,g.Q(this.K.localImageEntities));this.K.videoDownloadContextEntity&&J.push(this.K.videoDownloadContextEntity);return[].concat(g.Q(new Set(J)))};
g.M(qkk,X4);qkk.prototype.J=function(){return[]};
g.M(Atf,X4);Atf.prototype.J=function(){var J=[];this.K.fakeChildren&&J.push.apply(J,g.Q(this.K.fakeChildren));return[].concat(g.Q(new Set(J)))};
g.M(Ykq,X4);Ykq.prototype.J=function(){var J=[];this.K.video&&J.push(this.K.video);this.K.playbackData&&J.push(this.K.playbackData);this.K.offlineVideoPolicy&&J.push(this.K.offlineVideoPolicy);return[].concat(g.Q(new Set(J)))};
g.M(rtE,X4);rtE.prototype.J=function(){return[]};
g.M(jMV,X4);jMV.prototype.J=function(){var J=[];this.K.channelOwner&&J.push(this.K.channelOwner);this.K.videos&&J.push.apply(J,g.Q(this.K.videos));this.K.collaboratorChannels&&J.push.apply(J,g.Q(this.K.collaboratorChannels));this.K.downloadState&&J.push(this.K.downloadState);this.K.refresh&&J.push(this.K.refresh);return[].concat(g.Q(new Set(J)))};
g.M(mW9,X4);mW9.prototype.J=function(){var J=[];this.K.video&&J.push(this.K.video);this.K.channelContributor&&J.push(this.K.channelContributor);return[].concat(g.Q(new Set(J)))};
g.M(VAq,Cx);VAq.prototype.J=function(){var J=[];this.K.localImageEntities&&J.push.apply(J,g.Q(this.K.localImageEntities));this.K.videoDownloadContextEntity&&J.push(this.K.videoDownloadContextEntity);return[].concat(g.Q(new Set(J)))};
g.M(gZk,Cx);gZk.prototype.J=function(){var J=[];this.K.recommendedVideoMetadata&&J.push.apply(J,g.Q((new VAq(this.K.recommendedVideoMetadata)).J()));return[].concat(g.Q(new Set(J)))};
g.M(UWV,Cx);UWV.prototype.J=function(){var J=[];this.K.playbackPosition&&J.push(this.K.playbackPosition);return[].concat(g.Q(new Set(J)))};
g.M(pwU,X4);pwU.prototype.J=function(){var J=[];this.K.owner&&J.push(this.K.owner);this.K.downloadState&&J.push(this.K.downloadState);this.K.userState&&J.push.apply(J,g.Q((new UWV(this.K.userState)).J()));this.K.additionalMetadata&&J.push.apply(J,g.Q((new gZk(this.K.additionalMetadata)).J()));return[].concat(g.Q(new Set(J)))};
g.M(lyd,X4);lyd.prototype.J=function(){var J=[];this.K.userChannelDetails&&J.push(this.K.userChannelDetails);return[].concat(g.Q(new Set(J)))};
g.M(Pzq,X4);Pzq.prototype.J=function(){var J=[];this.K.channelOwner&&J.push(this.K.channelOwner);this.K.playbackPosition&&J.push(this.K.playbackPosition);this.K.localImageEntities&&J.push.apply(J,g.Q(this.K.localImageEntities));this.K.downloadStatus&&J.push(this.K.downloadStatus);return[].concat(g.Q(new Set(J)))};
g.M(zNJ,X4);zNJ.prototype.J=function(){return[]};
g.M(eN8,X4);eN8.prototype.J=function(){return[]};
g.M(wwq,X4);wwq.prototype.J=function(){return[]};
g.M(ctl,X4);ctl.prototype.J=function(){return[]};
g.M(hN8,X4);hN8.prototype.J=function(){return[]};
g.M(ytV,X4);ytV.prototype.J=function(){return[]};
g.M(G4q,X4);G4q.prototype.J=function(){return[]};
g.M(bH_,X4);bH_.prototype.J=function(){return[]};
g.M(tAU,X4);tAU.prototype.J=function(){return[]};
g.M(xWK,X4);xWK.prototype.J=function(){return[]};
g.M(JPf,X4);JPf.prototype.J=function(){var J=[];this.K.trackDownloadMetadatas&&J.push.apply(J,g.Q(this.K.trackDownloadMetadatas));return[].concat(g.Q(new Set(J)))};
g.M(ogd,X4);
ogd.prototype.J=function(){var J=[];this.K.downloadedTracks&&J.push.apply(J,g.Q(this.K.downloadedTracks));this.K.smartDownloadedTracks&&J.push.apply(J,g.Q(this.K.smartDownloadedTracks));this.K.downloadedEpisodes&&J.push.apply(J,g.Q(this.K.downloadedEpisodes));this.K.downloadedAlbumReleases&&J.push.apply(J,g.Q(this.K.downloadedAlbumReleases));this.K.smartDownloadedAlbumReleases&&J.push.apply(J,g.Q(this.K.smartDownloadedAlbumReleases));this.K.downloadedPlaylists&&J.push.apply(J,g.Q(this.K.downloadedPlaylists));this.K.smartDownloadedPlaylists&&
J.push.apply(J,g.Q(this.K.smartDownloadedPlaylists));this.K.metadataOnlyTracks&&J.push.apply(J,g.Q(this.K.metadataOnlyTracks));return[].concat(g.Q(new Set(J)))};
g.M(R59,X4);R59.prototype.J=function(){var J=[];this.K.trackDownloadMetadatas&&J.push.apply(J,g.Q(this.K.trackDownloadMetadatas));return[].concat(g.Q(new Set(J)))};
g.M(N5U,X4);N5U.prototype.J=function(){var J=[];this.K.playbackData&&J.push(this.K.playbackData);this.K.localImageEntities&&J.push.apply(J,g.Q(this.K.localImageEntities));this.K.videoDownloadContextEntity&&J.push(this.K.videoDownloadContextEntity);return[].concat(g.Q(new Set(J)))};
g.M(C7f,X4);C7f.prototype.J=function(){var J=[];this.K.musicLibraryStatusEntity&&J.push(this.K.musicLibraryStatusEntity);this.K.primaryArtists&&J.push.apply(J,g.Q(this.K.primaryArtists));this.K.details&&J.push(this.K.details);this.K.userDetails&&J.push(this.K.userDetails);this.K.tracks&&J.push.apply(J,g.Q(this.K.tracks));this.K.share&&J.push(this.K.share);this.K.downloadMetadata&&J.push(this.K.downloadMetadata);this.K.refresh&&J.push(this.K.refresh);return[].concat(g.Q(new Set(J)))};
g.M(XpV,X4);XpV.prototype.J=function(){var J=[];this.K.albumRelease&&J.push(this.K.albumRelease);this.K.tracks&&J.push.apply(J,g.Q(this.K.tracks));return[].concat(g.Q(new Set(J)))};
g.M(imk,X4);imk.prototype.J=function(){var J=[];this.K.albumRelease&&J.push(this.K.albumRelease);return[].concat(g.Q(new Set(J)))};
g.M(uuJ,X4);uuJ.prototype.J=function(){var J=[];this.K.details&&J.push(this.K.details);this.K.userDetails&&J.push(this.K.userDetails);return[].concat(g.Q(new Set(J)))};
g.M(fhl,X4);fhl.prototype.J=function(){var J=[];this.K.parentArtist&&J.push(this.K.parentArtist);return[].concat(g.Q(new Set(J)))};
g.M(T59,X4);T59.prototype.J=function(){var J=[];this.K.parentArtist&&J.push(this.K.parentArtist);return[].concat(g.Q(new Set(J)))};
g.M($uV,X4);$uV.prototype.J=function(){return[]};
g.M(Hmq,X4);Hmq.prototype.J=function(){return[]};
g.M(kN9,Cx);kN9.prototype.J=function(){var J=[];this.K.creatorEntity&&J.push(this.K.creatorEntity);return[].concat(g.Q(new Set(J)))};
g.M(vga,X4);
vga.prototype.J=function(){var J=[];this.K.tracks&&J.push.apply(J,g.Q(this.K.tracks));this.K.refresh&&J.push(this.K.refresh);this.K.musicLibraryStatusEntity&&J.push(this.K.musicLibraryStatusEntity);this.K.details&&J.push(this.K.details);this.K.downloadMetadata&&J.push(this.K.downloadMetadata);this.K.sideloadMetadata&&J.push(this.K.sideloadMetadata);this.K.userDetails&&J.push(this.K.userDetails);this.K.entryCollection&&J.push(this.K.entryCollection);this.K.share&&J.push(this.K.share);this.K.podcastShowAdditionalMetadata&&J.push.apply(J,
g.Q((new kN9(this.K.podcastShowAdditionalMetadata)).J()));return[].concat(g.Q(new Set(J)))};
g.M(W8k,X4);W8k.prototype.J=function(){return[]};
g.M(Slf,X4);
Slf.prototype.J=function(){var J=[];this.K.musicLibraryStatusEntity&&J.push(this.K.musicLibraryStatusEntity);this.K.artists&&J.push.apply(J,g.Q(this.K.artists));this.K.audioModeVersion&&J.push(this.K.audioModeVersion);this.K.videoModeVersion&&J.push(this.K.videoModeVersion);this.K.userDetails&&J.push(this.K.userDetails);this.K.details&&J.push(this.K.details);this.K.albumRelease&&J.push(this.K.albumRelease);this.K.share&&J.push(this.K.share);this.K.libraryEdit&&J.push(this.K.libraryEdit);this.K.downloadMetadata&&
J.push(this.K.downloadMetadata);this.K.playbackPosition&&J.push(this.K.playbackPosition);this.K.lyrics&&J.push(this.K.lyrics);return[].concat(g.Q(new Set(J)))};
g.M(L8d,X4);L8d.prototype.J=function(){var J=[];this.K.parentTrack&&J.push(this.K.parentTrack);return[].concat(g.Q(new Set(J)))};
g.M(Ihq,X4);Ihq.prototype.J=function(){var J=[];this.K.parentTrack&&J.push(this.K.parentTrack);return[].concat(g.Q(new Set(J)))};
g.M(F8E,X4);F8E.prototype.J=function(){return[]};
g.M(EgJ,X4);EgJ.prototype.J=function(){return[]};
g.M(M4q,X4);M4q.prototype.J=function(){return[]};
g.M(K8a,X4);K8a.prototype.J=function(){return[]};
g.M(ahd,X4);ahd.prototype.J=function(){var J=[];this.K.transfer&&J.push(this.K.transfer);this.K.adsPlaybackData&&J.push.apply(J,g.Q(this.K.adsPlaybackData));this.K.drmLicense&&J.push(this.K.drmLicense);this.K.offlineVideoPolicy&&J.push(this.K.offlineVideoPolicy);this.K.videoDownloadContextEntity&&J.push(this.K.videoDownloadContextEntity);return[].concat(g.Q(new Set(J)))};
g.M(QgK,X4);QgK.prototype.J=function(){return[]};
g.M(ngV,X4);ngV.prototype.J=function(){var J=[];this.K.offlineVideoStreams&&J.push.apply(J,g.Q(this.K.offlineVideoStreams));this.K.captionTrack&&J.push.apply(J,g.Q(this.K.captionTrack));return[].concat(g.Q(new Set(J)))};
g.M(DuV,X4);DuV.prototype.J=function(){return[]};
g.M(sga,X4);sga.prototype.J=function(){return[]};
g.M(B5q,X4);B5q.prototype.J=function(){return[]};
g.M(Omd,X4);Omd.prototype.J=function(){return[]};
g.M(ZmV,X4);ZmV.prototype.J=function(){return[]};
g.M(duP,X4);duP.prototype.J=function(){return[]};
g.M(qlV,X4);qlV.prototype.J=function(){return[]};
g.M(APd,X4);APd.prototype.J=function(){return[]};
g.M(Yla,X4);Yla.prototype.J=function(){return[]};
g.M(rPV,X4);rPV.prototype.J=function(){return[]};
g.M(jgV,X4);jgV.prototype.J=function(){return[]};
g.M(muU,X4);muU.prototype.J=function(){return[]};
g.M(V4K,X4);V4K.prototype.J=function(){return[]};
g.M(ggL,X4);ggL.prototype.J=function(){return[]};
g.M(UuV,X4);UuV.prototype.J=function(){return[]};
g.M(ppq,X4);ppq.prototype.J=function(){return[]};
var VWP=["browse","music/browse","unplugged/browse"],PH9=["offline/playlist_sync_check"],Oa8=["offline"],gH8=["offline/offline_video_playback_position_sync"],pQ9=["offline/get_playback_data_entity"],iQ;uQ.getInstance=function(){return g.Y(function(J){return J.return(new Promise(function(R){g.$s().then(function(N){N?(uQ.instance||(uQ.instance=new uQ(N)),R(uQ.instance)):R(void 0)})}))})};
uQ.prototype.get=function(J){var R=this,N,C,X;return g.Y(function(u){if(u.K==1)return g.q(u,e5U(R.token),2);if(u.K!=3)return N=u.J,g.q(u,N.get("prefs",J),3);C=u.J;if(!C)return u.return();X=(0,g.g9)();return C.expirationTimestampMs<=X?u.return():u.return(C.value)})};
uQ.prototype.set=function(J,R,N){N=N===void 0?31536E3:N;var C=this,X,u,f;return g.Y(function(H){if(H.K==1)return X=(0,g.g9)(),u={key:J,value:R,expirationTimestampMs:X+N*1E3},g.q(H,e5U(C.token),2);f=H.J;return g.q(H,g.e$(f,"prefs",u),0)})};
uQ.prototype.remove=function(J){var R=this,N;return g.Y(function(C){if(C.K==1)return g.q(C,e5U(R.token),2);N=C.J;return g.q(C,N.delete("prefs",J),0)})};
g.M(fx,g.C3);g.M(TU,GNV);TU.prototype.V=function(J,R){R=t4f(R);J=(new TextEncoder).encode(JSON.stringify(J));return this.K.encrypt(J,R)};
TU.prototype.J=function(J,R){if(!(J instanceof Uint8Array))throw wpL(1);var N=new TextDecoder;R=t4f(R);J=this.K.decrypt(J,R);return JSON.parse(N.decode(J))};
var xuK={accountLinkStatusEntity:EZ9,booleanEntity:HHJ,buttonEntity:Yla,captionTrack:F8E,channelHandle:TbK,commerceAcquisitionClientPayloadEntity:jgV,commerceCartListEntity:muU,contextNoteFeedEntityPayload:$WL,continuationTokenEntity:rtE,downloadQualityPickerEntity:QME,downloadsPageRefreshTokenEntity:DWJ,downloadsPageViewConfigurationEntity:zNJ,downloadStatusEntity:nZV,sfvAudioItemCurrentlyPlayingEntity:sga,emojiFountainDataEntity:qlV,emojiCustomizationSetEntity:duP,fakeChannel:k4d,fakePlaylist:vZf,
fakePlaylistEntryCollection:Sk8,fakeVideo:LnK,fakeVideoDescription:Iya,featuredProductsEntity:bH_,flowStateEntity:Fnl,iconBadgeEntity:V4K,interstitialInteractionStateEntity:Kn8,liveChatPollStateEntity:ayl,liveReactionsDataEntity:APd,logoEntity:MAf,macroMarkerEntity:eN8,mainDownloadsLibraryEntity:sMd,mainDownloadsListEntity:OHa,mainPlaylistDownloadStateEntity:ZHJ,mainPlaylistEntity:jMV,mainPlaylistVideoEntity:mW9,mainVideoDownloadStateEntity:dWf,mainVideoEntity:pwU,markersEngagementPanelSyncEntity:wwq,
markersVisibilityOverrideEntity:ctl,musicAlbumReleaseDetail:XpV,musicAlbumReleaseDownloadMetadataEntity:JPf,musicAlbumRelease:C7f,musicAlbumReleaseUserDetail:imk,musicArtistDetail:fhl,musicArtist:uuJ,musicArtistUserDetail:T59,musicDownloadsLibraryEntity:ogd,musicLibraryEdit:$uV,musicLibraryStatusEntity:Hmq,musicPlaylist:vga,musicPlaylistDownloadMetadataEntity:R59,musicShare:W8k,musicTrackDetail:L8d,musicTrackDownloadMetadataEntity:N5U,musicTrack:Slf,musicTrackUserDetail:Ihq,offlineOrchestrationActionWrapperEntity:EgJ,
offlineVideoPolicy:M4q,offlineVideoStreams:K8a,offlineabilityEntity:qkk,orchestrationWebSamplingEntity:Atf,pageHeaderEntity:ZmV,pdpStateEntity:ggL,pinnedProductEntity:tAU,playbackData:ahd,playerStateEntity:hN8,quantityIncrementerEntity:UuV,refresh:QgK,saveToPlaylistListEntity:B5q,settingEntity:Omd,suggestedFeedbackChipStateEntity:ytV,transfer:ngV,trendingOfferEntity:xWK,videoDownloadContextEntity:DuV,videoOverviewAsyncDataEntity:ppq,videoPlaybackPositionEntity:rPV,ytMainChannelEntity:lyd,youchatPendingResponseEntity:G4q,
ytMainDownloadedVideoEntity:Ykq,ytMainVideoEntity:Pzq};g.M(Sk,GNV);Sk.prototype.V=function(J){return J};
Sk.prototype.J=function(J){if(J instanceof Uint8Array)throw wpL(0);return J};
g.M(Lx,g.l);Lx.prototype.observe=function(J){var R=this;this.observers.push(J);return function(){var N=R.observers.indexOf(J);N>=0&&R.observers.splice(N,1)}};
Lx.prototype.J=function(J){vtU(this,J.data)};
Lx.prototype.Fk=function(){this.channel.close()};
var F5_,W68=new g.gl("elementsCommand");var wR=new g.gl("entityBatchUpdate");var RpE=new g.gl("downloadStatusEntity");var EIa=new g.gl("mainPlaylistEntityActionMetadata");var I7=new g.gl("mainVideoEntityActionMetadata");var BlL=new g.gl("musicPlaylistEntityActionMetadata");var JCV=new g.gl("musicTrackEntityActionMetadata");var rfP=new g.gl("localImageEntityActionMetadata");var NG=new g.gl("playbackDataActionMetadata");var SEa=new g.gl("transferEntityActionMetadata");var JcJ=new g.gl("videoPlaybackPositionEntityActionMetadata");var Ypa;new g.Qt;new g.Qt;gt9.prototype.request=function(J,R,N){R=R===void 0?{}:R;return this.locks.request(J,R,function(C){return N(C)})};var nx=g.mB.caches,QQ,zwf;a0.prototype.open=function(J){return nx.open(l$E(J))};
a0.prototype.has=function(J){return nx.has(l$E(J))};
a0.prototype.delete=function(J){return nx.delete(l$E(J))};
a0.prototype.match=function(J,R){var N=this,C,X,u,f,H,k;return g.Y(function(v){switch(v.K){case 1:return g.q(v,N.keys(),2);case 2:C=v.J,X=g.K(C),u=X.next();case 3:if(u.done){v.ZM(5);break}f=u.value;return g.q(v,N.open(f),6);case 6:return H=v.J,g.q(v,H.match(J,R),7);case 7:if(k=v.J)return v.return(k);u=X.next();v.ZM(3);break;case 5:return v.return()}})};
g.M(pKk,a0);pKk.prototype.keys=function(){var J,R,N,C,X,u,f,H,k;return g.Y(function(v){if(v.K==1)return J=[],R=g.XU("CacheStorage keys"),g.q(v,nx.keys(),2);N=v.J;C=g.K(N);for(X=C.next();!X.done;X=C.next()){u=X.value;var W=u.indexOf(":");f=W===-1?{kF:u}:{kF:u.substring(0,W),datasyncId:u.substring(W+1)};H=f.kF;k=f.datasyncId;k===R&&J.push(H)}return v.return(J)})};g.M(sP,g.l);sP.prototype.V=function(J){this.api.z7("onOfflineOperationFailure",J.data)};
sP.prototype.Z=function(J){this.api.publish("offlinetransferpause",J.data)};
sP.prototype.Fk=function(){var J;(J=this.K)==null||J.close();var R;(R=this.J)==null||R.close()};cXU.prototype.Fe=function(){this.K&&OP(this)};
cXU.prototype.AQ=function(){this.J&&this.J.resolve();this.V=this.K=!1;this.W()};var qEP=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var HaP="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var a1E="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.M(epl,Ji);epl.prototype.J=function(J){return Au(J)?hpq(this,J):Y2(J)?baq(this,J):Promise.reject(Error("Unsupported action type: "+J.actionType))};g.M(tWa,Ji);tWa.prototype.J=function(J){return Y2(J)?x0U(this,J):oHl(J)?oqL(this,J):rR(J)?Ry_(this,J):Promise.reject(Error("Unsupported action type: "+J.actionType))};g.T=Np9.prototype;g.T.yE8=function(J){var R=this,N,C,X,u;return g.Y(function(f){if(!g.h(J.state,128))return f.ZM(0);N=J.state.uu;var H=(C=N)==null?void 0:C.errorCode,k=(X=N)==null?void 0:X.rh;u=H==="net.connect"&&k===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(H==null?0:H.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.q(f,R.rJ(R.player.getVideoData().videoId,u),0)})};
g.T.rJ=function(J,R){var N=this;return g.Y(function(C){if(C.K==1){if(N.J)return C.return();N.J=!0;return R==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(il(N,J,!1,!0),C.ZM(0)):g.q(C,XF(N,J),3)}g.UA(J,4);return g.q(C,N.K.rJ(R),0)})};
g.T.ea=function(J){J.status===2?(J.status!==this.V&&(JfJ(this.K),g.UA(J.videoId,2)),J.gf&&X1K(this.K,J.videoId,J.gf)):J.status===4?(XF(this,J.videoId),this.rJ(J.videoId,J.Qf?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):J.status===1&&C4a(this.K);this.V=J.status;this.api.z7("localmediachange",{videoId:J.videoId,status:J.status})};
g.T.BZ=function(){var J=this,R;return g.Y(function(N){if(N.K==1){if(J.J)return N.return();J.J=!0;R=J.player.getVideoData().videoId;return g.q(N,XF(J,R),2)}return g.q(N,J.K.BZ(),0)})};
g.T.PF=function(J){switch(J){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.T.T=function(J){return this.api.N().T(J)};g.M($Ol,Ji);$Ol.prototype.J=function(J){return Au(J)?kOK(this,J):Y2(J)?vq8(this,J):oHl(J)?Whl(this,J):Promise.reject(Error("Unsupported action type: "+J.actionType))};MQa.prototype.K=function(J,R){var N=J.action.actionMetadata.priority-R.action.actionMetadata.priority;N===0&&(J.K<R.K?N=-1:J.K>R.K&&(N=1));return N};g.M(ul,g.l);ul.prototype.Fk=function(){this.W&&this.W();g.l.prototype.Fk.call(this)};
ul.prototype.createAction=function(J,R){var N=g.nX(J.entityKey).entityType,C=g.jg(16);return new UP(N,C,J,R.actionId,R.rootActionId)};
ul.prototype.dn=function(J){var R=this,N,C,X,u,f,H,k,v,W;return g.Y(function(S){if(S.K==1){if(R.QO())return S.return();C=(N=J.offlineOrchestrationActionWrapperEntity)!=null?N:new Set;X=[];u=g.K(C);for(f=u.next();!f.done;f=u.next())H=f.value,k=g.nX(H),v=k.entityId,QSP(R.K,v)||X.push(H);return g.q(S,rcd(R,X),2)}W=S.J;return g.q(S,YE9(R,W),0)})};
ul.prototype.retry=function(){var J=this;return g.Y(function(R){return g.q(R,jSl(J),0)})};g.M(fd,g.l);fd.prototype.Fk=function(){this.J&&this.J();g.l.prototype.Fk.call(this)};
fd.prototype.V=function(J){var R=this,N,C,X,u,f,H,k,v;return g.Y(function(W){C=(N=J.transfer)!=null?N:new Set;X=[];u=g.K(C);for(f=u.next();!f.done;f=u.next())H=f.value,k=g.nX(H),v=k.entityId,X.push(v);return X.length===0?W.return():g.q(W,lx9(R,X),0)})};g.M(ccl,g.l);g.T=ccl.prototype;g.T.Fk=function(){this.ma&&this.ma();this.tN.dispose();this.Z.dispose();this.G7&&g.hT(this.S.P9,this.G7);this.PC&&g.hT(this.S.P9,this.PC);g.l.prototype.Fk.call(this)};
g.T.jGC=function(J){var R=this,N,C,X;return g.Y(function(u){switch(u.K){case 1:N=g.DR(J,"transfer");if(R.K&&N===R.K.key){il(R.D,R.U,!0);R.Z.stop();u.ZM(0);break}return g.q(u,I0(R.J,{mode:"readwrite",QK:!0},function(f){return $2(f,N,"transfer").then(function(H){if(H&&H.transferState!=="TRANSFER_STATE_COMPLETE"&&H.transferState!=="TRANSFER_STATE_FAILED")return H.transferState="TRANSFER_STATE_PAUSED_BY_USER",v4(f,H,"transfer").then(function(){return H})})}),3);
case 3:C=u.J;if(!C){u.ZM(0);break}if(!J||!R.V){u.ZM(5);break}return g.q(u,jk(J,R.V,R.J,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.q(u,HL(R,J),7);case 7:X=u.J,xhJ({videoId:J,wU:C,offlineModeType:X}),g.IQ(u)}})};
g.T.sGN=function(){var J=this;if(this.K&&this.U){il(this.D,this.U,!1);var R=this.K,N=(R==null?0:R.key)?g.nX(R.key).entityId:"";N&&this.V&&(new Promise(function(C,X){jk(N,J.V,J.J,"DOWNLOAD_STATE_PAUSED").catch(function(u){X(u)})})).catch(function(C){DY("Download state setting error",C)})}this.Z.stop()};
g.T.rf=function(){this.K?GOJ(this,this.K):$D(this)};
g.T.nQ=function(J){var R=this;return g.Y(function(N){switch(N.K){case 1:if(!R.K){N.ZM(2);break}if(R.K.transferState==="TRANSFER_STATE_COMPLETE"||R.K.transferState==="TRANSFER_STATE_FAILED"||!J.transfer||!J.transfer.has(R.K.key)){N.ZM(3);break}return g.q(N,EP(R.J,R.K.key,"transfer"),4);case 4:R.K=N.J;if(R.K){N.ZM(3);break}return g.q(N,b48(R),3);case 3:if(R.K)return N.return();case 2:return g.q(N,$D(R),0)}})};
g.T.rJ=function(J,R){var N=this,C,X,u,f,H;return g.Y(function(k){switch(k.K){case 1:if(!N.K){kD(N,"onTransferFailure: "+J);k.ZM(2);break}C=N.K;u=((X=C)==null?0:X.key)?g.nX(C.key).entityId:"";a:switch(J){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var v=!1;break a;default:v=!0}return v&&iI8(N)?g.q(k,vL(N,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.q(k,
u6q(N,J),5);case 5:if(!u||!N.V){k.ZM(2);break}return g.q(k,jk(u,N.V,N.J,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.q(k,HL(N,u),9);case 9:f=k.J;dR({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:u,wU:C,offlineModeType:f});if(!u||!N.V){k.ZM(2);break}return g.q(k,jk(u,N.V,N.J,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Tq(N),H=$D(N,!0),R&&R(H),g.IQ(k)}})};
g.T.BZ=function(J){var R=this,N,C,X,u,f,H,k,v,W,S,L,I;return g.Y(function(F){switch(F.K){case 1:if(!R.K){kD(R,"onMaybeTransferStreamsExpired");F.ZM(2);break}return iI8(R)?g.q(F,vL(R,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.q(F,u6q(R,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!R.V){F.ZM(2);break}N=R.K;X=((C=N)==null?0:C.key)?g.nX(N.key).entityId:"";if(!X){F.ZM(2);break}return g.q(F,jk(X,R.V,R.J,"DOWNLOAD_STATE_FAILED"),2);case 9:return R.K||kD(R,"onMaybeTransferStreamsExpiredRetryAttempting"),
u=R.K,H=((f=u)==null?0:f.key)?g.nX(u.key).entityId:"",g.q(F,HL(R,H),10);case 10:return k=F.J,dR({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:H,wU:u,offlineModeType:k}),v=XQP(),g.ol(v,NG,{isEnqueuedForExpiredStreamUrlRefetch:!0}),W=g.DR(H,"playbackData"),S={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:W,actionMetadata:v},L=lQ(new UP("playbackData",H,S)),g.q(F,F4(R.J,L,"offlineOrchestrationActionWrapperEntity"),2);case 2:Tq(R),I=$D(R,!0),
J&&J(I),g.IQ(F)}})};
var H3U={},feJ=(H3U.TRANSFER_STATE_TRANSFERRING=1,H3U.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,H3U);g.T=WL.prototype;g.T.pU=function(){return this.U.promise};
g.T.EY=function(){if(this.J&&this.D)return this.U.promise;HIq(this).then(this.U.resolve).catch(this.U.reject);return this.U.promise};
g.T.I_=function(J){var R={};return R.playbackData=new epl(J,this.KC,this.K),R.transfer=new $Ol(J,this.KC),R.videoPlaybackPositionEntity=new tWa(J,this.KC),R};
g.T.OY=function(){var J=this;return g.Y(function(R){return J.J?g.q(R,hy_(J.J),0):R.ZM(0)})};
g.T.w9=function(){var J=this,R,N;return g.Y(function(C){if(C.K==1)return J.J||J.D?g.q(C,J.pU(),2):C.return();J.X!==void 0&&(g.dp(J.X),J.X=void 0);J.Z!==void 0&&(g.dp(J.Z),J.Z=void 0);(R=J.J)==null||R.dispose();J.J=void 0;(N=J.D)==null||N.dispose();J.D=void 0;J.api.z7("onOrchestrationLostLeader");J.U=new g.Qt;g.IQ(C)})};
g.T.isOrchestrationLeader=function(){return this.V.K};
g.T.mJ=function(){return g.Y(function(J){return J.return(!1)})};
g.T.YM=function(J){var R=this.K;R.api.publish("offlinetransferpause",J);var N;(N=R.J)==null||N.postMessage(J)};
g.T.rf=function(J){var R,N;return g.Y(function(C){if(C.K==1)return g.q(C,Kx(),2);R=C.J;if(!R)return C.return();N=g.DR(J,"transfer");return g.q(C,I0(R,{mode:"readwrite",QK:!0},function(X){var u=$2(X,N,"transfer"),f=$2(X,g.DR(J,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.r9.all([u,f]).then(function(H){H=g.K(H);var k=H.next().value;var v=H.next().value;return k&&k.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(k.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",v4(X,k,"transfer").then(function(){dR({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:J,wU:k,offlineModeType:v==null?void 0:v.offlineModeType});return g.r9.resolve(null)})):g.r9.resolve(null)})}),0)})};
g.T.f7=function(J){J=J===void 0?43200:J;var R=this,N,C,X,u,f,H,k,v;return g.Y(function(W){if(W.K==1)return R.S.Tj()?g.q(W,Kx(),2):W.return(km9());if(W.K!=3){N=W.J;if(!N)return W.return([]);C=Date.now()/1E3;return g.q(W,Me(N,"offlineVideoPolicy"),3)}X=W.J;u=[];f=g.K(X);for(H=f.next();!H.done;H=f.next())k=H.value,Number(k.lastUpdatedTimestampSeconds)+J<=C&&(v=g.nX(k.key).entityId,u.push(v));return u.length?W.return(SX(R,u,R.W,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):W.return([])})};
g.T.deleteAll=function(){return SX(this,["!*$_ALL_ENTITIES_!*$"],this.W,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.T.refreshAllStaleEntities=function(J){var R=this;return g.Y(function(N){return N.K==1?g.q(N,R.f7(J),2):N.return(N.J)})};
g.T.setUpPositionSyncInterval=function(J){var R=this;this.Z!==void 0&&(g.dp(this.Z),this.Z=void 0);var N=J!=null?J:864E5;this.Z=g.OE(function(){R.uX(N)},N)};
g.T.uX=function(J){var R=this,N,C,X,u,f,H;return g.Y(function(k){switch(k.K){case 1:return g.Ef(k,2),g.q(k,uQ.getInstance(),4);case 4:N=k.J;if(!N)throw Error("prefStorage is undefined");return g.q(k,N.get("psi"),5);case 5:C=k.J;u=((X=C)==null?0:X.Bp)?Number(C.Bp)/1E3:0;f=Date.now();if(!(u+J<=f)){k.ZM(6);break}return g.q(k,SX(R,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.MP(k,0);break;case 2:H=g.K2(k),DY("Offline manager error",H),
g.IQ(k)}})};
g.T.cM=function(){var J=this,R,N,C,X,u,f,H;return g.Y(function(k){if(k.K==1)return g.q(k,Kx(),2);if(k.K!=3)return(R=k.J)?g.q(k,Me(R,"transfer"),3):k.return([]);N=k.J;C=[];X=g.K(N);for(u=X.next();!u.done;u=X.next())f=u.value,f.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&f.key&&(H=g.nX(f.key).entityId,C.push(H));return k.return(Wjl(J,C))})};
g.T.qm=function(){return g.Y(function(J){return J.return([])})};
g.T.nu=function(){return g.Y(function(J){g.IQ(J)})};
g.T.U8=function(){return g.Y(function(J){g.IQ(J)})};g.M(S79,Ji);S79.prototype.J=function(J){return Au(J)?Fj9(this,J):Y2(J)?M0L(this,J):rR(J)?KjK(this,J):Promise.reject(Error("Unsupported action type: "+J.actionType))};
var Ld=[10];g.M(sc9,Ji);sc9.prototype.J=function(J){return Au(J)?ZIl(this,J):Y2(J)?dYf(this,J):rR(J)?q7J(this,J):Promise.reject(Error("Unsupported action type: "+J.actionType))};
var OI9=[10];g.M(Y7K,Ji);Y7K.prototype.J=function(J){return Y2(J)?jc_(this,J):Promise.reject(Error("Unsupported action type: "+J.actionType))};g.M(mYa,WL);g.T=mYa.prototype;g.T.I_=function(J){var R=WL.prototype.I_.call(this,J);R.mainVideoEntity=new sc9(J,this.KC,this.K);R.mainPlaylistEntity=new S79(J,this.KC,this.K);R.mainDownloadsListEntity=new Y7K(J,this.KC,this.K);return R};
g.T.refreshAllStaleEntities=function(J,R){var N=this,C,X,u,f,H,k,v,W,S,L,I;return g.Y(function(F){switch(F.K){case 1:C=[];if(!N.KC.T("web_player_offline_playlist_auto_refresh")){F.ZM(2);break}return g.q(F,V0E(N,J,R),3);case 3:C=F.J;case 2:return g.q(F,uQ.getInstance(),4);case 4:return X=F.J,g.q(F,(u=X)==null?void 0:u.get("sdois"),5);case 5:return f=F.J,g.q(F,(H=X)==null?void 0:H.get("lmqf"),6);case 6:k=F.J;if(!f){F.ZM(7);break}W=C;S=W.concat;return g.q(F,gId(N,f,(v=k)!=null?v:"SD",J===0),8);case 8:C=
S.call(W,F.J);case 7:return L=C,I=L.concat,g.q(F,WL.prototype.refreshAllStaleEntities.call(N,J,R),9);case 9:return C=I.call(L,F.J),F.return(C)}})};
g.T.mJ=function(J){var R,N,C,X,u,f,H,k;return g.Y(function(v){if(v.K==1)return g.q(v,Kx(),2);if(v.K!=3)return(R=v.J)?g.q(v,EP(R,g.$_,"mainDownloadsListEntity"),3):v.return(!1);N=v.J;if((C=N)==null?0:(X=C.downloads)==null?0:X.length)for(u=g.DR(J,"mainVideoEntity"),f=g.K(N.downloads),H=f.next();!H.done;H=f.next())if(k=H.value,k.videoItem===u)return v.return(!0);return v.return(!1)})};
g.T.qm=function(){var J=this,R,N,C,X,u,f,H,k;return g.Y(function(v){if(v.K==1)return g.q(v,Kx(),2);if(v.K!=3)return(R=v.J)?g.q(v,Me(R,"downloadStatusEntity"),3):v.return([]);N=v.J;C=[];X=g.K(N);for(u=X.next();!u.done;u=X.next())f=u.value,f.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&f.key&&(H=g.nX(f.key).entityId,C.push(H));return C.length?(k={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},v.return(SX(J,C,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
k))):v.return([])})};
g.T.U8=function(){var J;return g.Y(function(R){return R.K==1?g.q(R,Kx(),2):(J=R.J)?g.q(R,I0(J,{mode:"readwrite",QK:!0},function(N){return H4(N,"mainVideoEntity").then(function(C){var X=[];C=g.K(C);for(var u=C.next();!u.done;u=C.next()){u=u.value;var f=void 0;(f=u.userState)!=null&&f.playbackPosition||(f=g.nX(u.key).entityId,f={key:g.DR(f,"videoPlaybackPositionEntity"),videoId:f,lastPlaybackPositionSeconds:"0"},X.push(v4(N,f,"videoPlaybackPositionEntity")),u.userState={playbackPosition:f.key},X.push(v4(N,
u,"mainVideoEntity")))}return g.r9.all(X)})}),0):R.return()})};
g.T.nu=function(){var J,R,N,C,X,u,f,H,k,v,W,S,L,I,F,a,n,B,Z,A,V,p,b,w,RQ,$E,G,e,t,E,y,b8,FV,Hl,Of,oU,SE,tk;return g.Y(function(D){if(D.K==1)return g.q(D,Kx(),2);if(D.K!=3){J=D.J;if(!J)return D.return();R=g.DR("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.q(D,I0(J,{mode:"readonly",QK:!0},function(O){return g.r9.all([$2(O,R,"mainDownloadsListEntity"),$2(O,g.$_,"mainDownloadsListEntity"),H4(O,"mainVideoEntity"),H4(O,"mainPlaylistEntity")])}),3)}N=D.J;
C=g.K(N);X=C.next().value;u=C.next().value;f=C.next().value;H=C.next().value;k=X;v=u;W=f;S=H;L=new Set;if((I=k)==null?0:(F=I.downloads)==null?0:F.length)for(a=g.K(k.downloads),n=a.next();!n.done;n=a.next())B=n.value,Z=void 0,(A=(Z=B.videoItem)!=null?Z:B.playlistItem)&&L.add(A);if((V=v)==null?0:(p=V.downloads)==null?0:p.length)for(b=g.K(v.downloads),w=b.next();!w.done;w=b.next())RQ=w.value,RQ.videoItem&&L.add(RQ.videoItem);$E=new Set;G=[];e=g.K(S);for(t=e.next();!t.done;t=e.next()){E=t.value;if(E.videos)for(y=
g.K(E.videos),b8=y.next();!b8.done;b8=y.next())FV=b8.value,(Hl=JSON.parse(g.nX(FV).entityId).videoId)&&$E.add(Hl);E.key&&!L.has(E.key)&&G.push(E.key)}Of=g.K(W);for(oU=Of.next();!oU.done;oU=Of.next())SE=oU.value,SE.key&&!L.has(SE.key)&&(tk=g.nX(SE.key).entityId,$E.has(tk)||G.push(SE.key));return G.length?g.q(D,F6V(J,G),0):D.ZM(0)})};g.M(UYV,Ji);UYV.prototype.J=function(J){return Au(J)?leq(this,J):Y2(J)?P4f(this,J):rR(J)?zmk(this,J):Promise.reject(Error("Unsupported action type: "+J.actionType))};
var FF=[10];g.M(w1q,Ji);w1q.prototype.J=function(J){return Au(J)?hmq(this,J):Y2(J)?yf8(this,J):rR(J)?Gm9(this,J):Promise.reject(Error("Unsupported action type: "+J.actionType))};
var E3=[10];g.M(xYJ,Ji);xYJ.prototype.J=function(J){return Au(J)?N9U(this,J):Y2(J)?CS9(this,J):rR(J)?X9E(this,J):Promise.reject(Error("Unsupported action type: "+J.actionType))};
var R4K=[10];g.M(MG,WL);MG.prototype.I_=function(J){var R=WL.prototype.I_.call(this,J);R.musicTrack=new xYJ(J,this.K);R.musicPlaylist=new w1q(J,this.K);R.musicAlbumRelease=new UYV(J,this.K);return R};
MG.prototype.refreshAllStaleEntities=function(J,R){var N=this,C,X,u;return g.Y(function(f){if(f.K==1)return g.q(f,uUK(N,J,R),2);if(f.K!=3)return X=C=f.J,u=X.concat,g.q(f,WL.prototype.refreshAllStaleEntities.call(N,J,R),3);C=u.call(X,f.J);return f.return(C)})};g.M(fI8,g.Sx);g.T=fI8.prototype;g.T.create=function(){var J=this;g.P(this,this.events);g.Xk(this.KC)?this.K=new mYa(this.KC,this.player):g.N3(this.KC)&&(this.K=new MG(this.KC,this.player));this.events.L(this.player,"onPlaybackStartExternal",function(){J.ON()});
this.events.L(this.player,"videodatachange",function(){J.ON()});
this.KC.T("html5_offline_playback_position_sync")&&this.events.L(this.player,"presentingplayerstatechange",this.nU)};
g.T.d4=function(){return!1};
g.T.pI=function(J,R,N,C){var X=this;return g.Y(function(u){return X.K?u.return(SX(X.K,J,R,N,C)):u.return(Promise.reject())})};
g.T.deleteAll=function(){return this.K.deleteAll()};
g.T.f7=function(J){return this.K.f7(J)};
g.T.refreshAllStaleEntities=function(J){return this.K.refreshAllStaleEntities(J)};
g.T.setUpPositionSyncInterval=function(J){this.K.setUpPositionSyncInterval(J)};
g.T.YM=function(J){this.K.YM(J)};
g.T.rf=function(J){return this.K.rf(J)};
g.T.ON=function(){var J=this,R;return g.Y(function(N){R=J.player.getVideoData();return g.e9(R)?T9a(R)&&J.J!==R.clientPlaybackNonce?g.q(N,$zd(J,R),0):N.ZM(0):N.return()})};
g.T.nU=function(J){var R=this,N,C,X,u,f,H,k;return g.Y(function(v){if(v.K==1)return N=R.player.getVideoData(),C=N.EL,g.Yp(J,2)||g.Yp(J,512)?g.q(v,Kx(),2):v.return();if(v.K!=3){X=v.J;if(!X)return DY("PES is undefined"),v.return();u=N.videoId;return g.q(v,EP(X,g.DR(u,"mainVideoEntity"),"mainVideoEntity"),3)}f=v.J;if(!f)return v.return();H=Math.floor(C).toString();k={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:H}};return g.q(v,R.pI([u],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
k),0)})};
g.T.isOrchestrationLeader=function(){return this.K.isOrchestrationLeader()};
g.T.updateDownloadState=function(J,R){var N,C,X,u;return g.Y(function(f){if(f.K==1)return g.q(f,Kx(),2);N=f.J;if(!N)return DY("PES is undefined"),f.return();C=g.nX(J);X=C.entityType;u=C.entityId;return g.q(f,jk(u,X,N,R,!0),0)})};g.WY("offline",fI8);})(_yt_player);
